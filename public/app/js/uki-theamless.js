(function(){var u=this,p=document,A=navigator.userAgent,D="uki"+ +new Date,r=Math.max,z=Math.min,G=Math.floor,E=Math.ceil;u.uki=u.uki||function(b,a){if(typeof b=="string"){var c=b.match(/^#((?:[\w\u00c0-\uFFFF_-]|\\.)+)$/),d=c&&uki._ids[c[1]];if(c&&!a)return new uki.Collection(d?[d]:[]);return uki.find(b,a)}if(b.length===undefined)b=[b];if(b.length>0&&uki.isFunction(b[0].typeName))return new uki.Collection(b);return uki.build(b)};uki.version="0.2.0";uki.guid=1;uki.F=function(){return false};uki._ids=
{};uki.registerId=function(b){uki._ids[uki.attr(b,"id")]=b};uki.unregisterId=function(b){uki._ids[uki.attr(b,"id")]=undefined};var K=Object.prototype.toString,L=String.prototype.trim,H=Array.prototype.slice,M=/^\s+|\s+$/g,I={attr:function(b,a,c){if(c!==undefined){if(b[a]&&b[a].apply)b[a](c);else b[a]=c;return b}else return b[a]&&b[a].apply?b[a]():b[a]},proxy:function(b,a){var c=H.call(arguments,2),d=function(){return b.apply(a,c.concat(H.call(arguments,0)))};d.huid=b.huid=b.huid||uki.guid++;return d},
isFunction:function(b){return K.call(b)==="[object Function]"},isArray:function(b){return K.call(b)==="[object Array]"},trim:function(b){b=b||"";return L?L.call(b):b.replace(M,"")},escapeHTML:function(b){var a={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"};return(b+"").replace(/[&<>\"\']/g,function(c){return a[c]})},each:function(b,a,c){var d,f=0,e=b.length;if(e===undefined)for(d in b){if(!(!d||b[d]===undefined||!b.hasOwnProperty(d)))if(a.call(c||b[d],d,b[d])===false)break}else for(d=
b[0];f<e&&a.call(c||d,f,d)!==false;d=b[++f]);return b},inArray:function(b,a){for(var c=0,d=a.length;c<d;c++)if(a[c]===b)return c;return-1},unique:function(b){if(b.length&&(typeof b[0]=="object"||typeof b[0]=="function")){var a=[],c;for(c=0;c<b.length;c++){b[c].__uki_marked||(a[a.length]=b[c]);b[c].__uki_marked=true}for(c=0;c<a.length;c++)delete a[c].__uki_marked;return a}else{a=[];var d={};c=0;for(var f=b.length;c<f;c++){var e=b[c];if(!d[e]){d[e]=true;a.push(b[c])}}return a}},grep:function(b,a){for(var c=
[],d=0,f=b.length;d<f;d++)a(b[d],d)&&c.push(b[d]);return c},map:function(b,a,c){for(var d=[],f=uki.isFunction(a)?a:function(k){return uki.attr(k,a)},e=0,g=b.length;e<g;e++){var j=f.call(c||b[e],b[e],e);if(j!=null)d[d.length]=j}return d},reduce:function(b,a,c,d){for(var f=0,e=a.length;f<e;f++)b=c.call(d||a[f],b,a[f],f);return b},extend:function(){for(var b=arguments[0]||{},a=1,c=arguments.length,d;a<c;a++)if((d=arguments[a])!=null)for(var f in d){var e=d[f];if(e!==undefined)b[f]=e}return b},newClass:function(){var b=
function(){this.init.apply(this,arguments)},a,c;c=0;var d;a=[];if(arguments.length>1)if(arguments[0].prototype){a=function(){};a.prototype=arguments[0].prototype;b.prototype=new a;c=1;a=[a.prototype]}for(c=c;c<arguments.length;c++){d=arguments[c];if(this.isFunction(d))d=d.apply(d,a);a.push(d);uki.extend(b.prototype,arguments[c])}if(!b.prototype.init)b.prototype.init=function(){};return b},binarySearch:function(b,a){for(var c=0,d=a.length,f;c<d;){f=c+d>>1;a[f]<b?(c=f+1):(d=f)}return c},newProp:function(b,
a){return function(c){if(c===undefined)return this[b];if(a)a.call(this,c);else this[b]=c;return this}},addProps:function(b,a){uki.each(a,function(){b[this]=uki.newProp("_"+this)})},toArray:function(b){return H.call(b,0)},delegateProp:function(b,a,c){var d="_"+a;b[a]=function(f){if(f===undefined){if(this[c])return uki.attr(this[c],a,f);return this[d]}if(this[c])uki.attr(this[c],a,f);else this[d]=f;return this}}};I.extend(uki,I);delete I;uki.geometry={};var v=uki.geometry.Point=function(b,a){this.x=
b*1||0;this.y=a*1||0};v.prototype={toString:function(){return this.x+" "+this.y},clone:function(){return new v(this.x,this.y)},eq:function(b){return this.x==b.x&&this.y==b.y},offset:function(b,a){if(typeof b=="object"){a=b.y;b=b.x}this.x+=b;this.y+=a;return this},constructor:v};v.fromString=function(b){b=b.split(/\s+/);return new v(b[0],b[1])};var s=uki.geometry.Size=function(b,a){this.width=b*1||0;this.height=a*1||0};s.prototype={toString:function(){return this.width+" "+this.height},clone:function(){return new s(this.width,
this.height)},eq:function(b){return this.width==b.width&&this.height==b.height},empty:function(){return this.width<=0||this.height<=0},constructor:s};s.fromString=function(b){b=b.split(/\s+/);return new s(b[0],b[1])};s.create=function(b,a){if(b===undefined)return null;if(b.width!==undefined)return b;if(/\S+\s+\S+/.test(b+""))return s.fromString(b,a);return new s(b,a)};var q=uki.geometry.Rect=function(b,a,c,d){if(c!==undefined){this.x=b*1||0;this.y=a*1||0;this.width=c*1||0;this.height=d*1||0}else if(b===
undefined||b.x===undefined){this.y=this.x=0;this.width=b*1||0;this.height=a*1||0}else{this.x=b?b.x*1:0;this.y=b?b.y*1:0;this.width=a?a.width*1:0;this.height=a?a.height*1:0}};q.prototype={toString:function(){return[this.x,this.y,this.width,this.height].join(" ")},toCoordsString:function(){return[this.x,this.y,this.maxX(),this.maxY()].join(" ")},clone:function(){return new q(this.x,this.y,this.width,this.height)},minX:function(){return this.x},maxX:function(){return this.x+this.width},midX:function(){return this.x+
this.width/2},minY:function(){return this.y},midY:function(){return this.y+this.height/2},maxY:function(){return this.y+this.height},normalize:function(){this.x=this.y=0;return this},empty:s.prototype.empty,eq:function(b){return b&&this.x==b.x&&this.y==b.y&&this.height==b.height&&this.width==b.width},inset:function(b,a){this.x+=b;this.y+=a;this.width-=b*2;this.height-=a*2;return this},offset:v.prototype.offset,intersection:function(b){var a=new v(r(this.x,b.x),r(this.y,b.y));b=new s(z(this.maxX(),
b.maxX())-a.x,z(this.maxY(),b.maxY())-a.y);return b.empty()?new q:new q(a,b)},union:function(b){return q.fromCoords(z(this.x,b.x),z(this.y,b.y),r(this.maxX(),b.maxX()),r(this.maxY(),b.maxY()))},containsPoint:function(b){return b.x>=this.minX()&&b.x<=this.maxX()&&b.y>=this.minY()&&b.y<=this.maxY()},containsRect:function(b){return this.eq(this.union(b))},constructor:q};q.prototype.left=q.prototype.minX;q.prototype.top=q.prototype.minY;q.fromCoords=function(b,a,c,d){if(c===undefined)return new q(b.x,
b.y,a.x-b.x,a.y-b.y);return new q(b,a,c-b,d-a)};q.fromCoordsString=function(b){b=b.split(/\s+/);return q.fromCoords(b[0],b[1],b[2],b[3])};q.fromString=function(b){b=b.split(/\s+/);if(b.length>2)return new q(b[0],b[1],b[2],b[3]);return new q(b[0],b[1])};q.create=function(b,a,c,d){if(b===undefined)return null;if(b.x!==undefined)return b;if(/\S+\s+\S+/.test(b+""))return q.fromString(b,a);if(c===undefined)return new q(b,a);return new q(b,a,c,d)};var x=uki.geometry.Inset=function(b,a,c,d){this.top=b*1||
0;this.right=a*1||0;this.bottom=c===undefined?this.top*1:c*1;this.left=d===undefined?this.right*1:d*1};x.prototype={toString:function(){return[this.top,this.right,this.bottom,this.left].join(" ")},clone:function(){return new x(this.top,this.right,this.bottom,this.left)},width:function(){return this.left+this.right},height:function(){return this.top+this.bottom},negative:function(){return this.top<0||this.left<0||this.right<0||this.bottom<0},empty:function(){return!this.top&&!this.left&&!this.right&&
!this.bottom}};x.fromString=function(b){b=b.split(/\s+/);if(b.length<3)b[2]=b[0];if(b.length<4)b[3]=b[1];return new x(b[0],b[1],b[2],b[3])};x.create=function(b,a,c,d){if(b===undefined)return null;if(b.top!==undefined)return b;if(/\S+\s+\S+/.test(b+""))return x.fromString(b,a);if(c===undefined)return new x(b,a);return new x(b,a,c,d)};uki.dom={createElement:function(b,a,c){b=p.createElement(b);if(a)b.style.cssText=a;if(c)b.innerHTML=c;b[D]=uki.guid++;return b},probe:function(b,a){var c=p.body;c.appendChild(b);
a=a(b);c.removeChild(b);return a},layout:function(b,a,c){c=c||{};if(c.left!=a.left)b.left=a.left+"px";if(c.top!=a.top)b.top=a.top+"px";if(c.right!=a.right)b.right=a.right+"px";if(c.bottom!=a.bottom)b.bottom=a.bottom+"px";if(c.width!=a.width)b.width=r(a.width,0)+"px";if(c.height!=a.height)b.height=r(a.height,0)+"px";return a},computedStyle:function(b){if(p&&p.defaultView&&p.defaultView.getComputedStyle)return p.defaultView.getComputedStyle(b,null);else if(b.currentStyle)return b.currentStyle},contains:function(b,
a){try{if(b.contains)return b.contains(a);if(b.compareDocumentPosition)return!!(b.compareDocumentPosition(a)&16)}catch(c){}for(;a&&a!=b;)try{a=a.parentNode}catch(d){a=null}return b==a},createStylesheet:function(b){var a=p.createElement("style");p.getElementsByTagName("head")[0].appendChild(a);if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(document.createTextNode(b));return a}};uki.each(["createElement"],function(b,a){uki[a]=uki.dom[a]});uki.dom.special={};uki.dom.Event=function(b){b=b||
{};this.domEvent=b.domEvent||b;for(var a=uki.dom.props.length,c;a;){c=uki.dom.props[--a];this[c]=b[c]}};uki.dom.Event.prototype=new (function(){function b(){return true}this.preventDefault=function(){var a=this.domEvent;a.preventDefault&&a.preventDefault();a.returnValue=false;this.isDefaultPrevented=b};this.stopPropagation=function(){var a=this.domEvent;a.stopPropagation&&a.stopPropagation();a.cancelBubble=true;this.isPropagationStopped=b};this.isDefaultPrevented=this.isPropagationStopped=uki.F});
uki.extend(uki.dom,{bound:{},handlers:{},props:"type altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode metaKey newValue originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which dragOffset dataTransfer".split(" "),events:"blur focus load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error draggesturestart draggestureend draggesture dragstart dragend drag drop dragenter dragleave dragover".split(" "),
bind:function(b,a,c){if(b.setInterval&&b!=window)b=window;c.huid=c.huid||uki.guid++;var d=b[D]=b[D]||uki.guid++,f=uki.dom.handlers[d]=uki.dom.handlers[d]||function(){uki.dom.handler.apply(arguments.callee.elem,arguments)},e,g;f.elem=b;uki.dom.bound[d]||(uki.dom.bound[d]={});a=a.split(" ");for(e=0;e<a.length;e++){g=a[e];if(!uki.dom.bound[d][g]){uki.dom.bound[d][g]=[];if(!uki.dom.special[g]||uki.dom.special[g].setup.call(b)===false)b.addEventListener?b.addEventListener(g,f,false):b.attachEvent("on"+
g,f)}uki.dom.bound[d][g].push(c)}c=f=b=null},unbind:function(b,a,c){var d=b[D],f=c&&c.huid,e,g;if(a)a=a.split(" ");else{a=[];uki.each(uki.dom.bound[d]||[],function(k){a.push(k)})}for(e=0;e<a.length;e++){g=a[e];if(!(!d||!uki.dom.bound[d]||!uki.dom.bound[d][g])){uki.dom.bound[d][g]=c?uki.grep(uki.dom.bound[d][g],function(k){return k.huid!==f}):[];if(uki.dom.bound[d][g].length==0){var j=uki.dom.handlers[d];if(!uki.dom.special[g]||uki.dom.special[g].teardown.call(b)===false)b.removeEventListener?b.removeEventListener(g,
j,false):b.detachEvent("on"+g,j);uki.dom.bound[d][g]=null}}}},handler:function(b){b=b||u.event;var a=b.type,c=this[D],d=uki.dom.bound[c];if(!b.domEvent){b=new uki.dom.Event(b);b=uki.dom.fix(b)}if(!(!c||!d||!d[a])){c=0;for(d=d[a];c<d.length;c++)d[c].call(this,b)}},fix:function(b){if(!b.target)b.target=b.srcElement||p;if(b.target.nodeType==3)b.target=b.target.parentNode;if(!b.relatedTarget&&b.fromElement)b.relatedTarget=b.fromElement==b.target?b.toElement:b.fromElement;if(b.pageX==null&&b.clientX!=
null){var a=p.documentElement,c=p.body;b.pageX=b.clientX+(a&&a.scrollLeft||c&&c.scrollLeft||0)-(a.clientLeft||0);b.pageY=b.clientY+(a&&a.scrollTop||c&&c.scrollTop||0)-(a.clientTop||0)}if(!b.which&&(b.charCode||b.charCode===0?b.charCode:b.keyCode))b.which=b.charCode||b.keyCode;if(!b.metaKey&&b.ctrlKey)try{b.metaKey=b.ctrlKey}catch(d){}if(!b.which&&b.button)b.which=b.button&1?1:b.button&2?3:b.button&4?2:0;return b},preventDefaultHandler:function(b){b&&b.preventDefault();return false}});uki.each({mouseover:"mouseenter",
mouseout:"mouseleave"},function(b,a){var c=function(d){if(!uki.dom.contains(this,d.relatedTarget)){d.type=a;uki.dom.handler.apply(this,arguments)}};uki.dom.special[a]={setup:function(){uki.dom.bind(this,b,c)},teardown:function(){uki.dom.unbind(this,b,c)}}});u.attachEvent&&u.attachEvent("onunload",function(){uki.each(uki.dom.bound,function(b,a){uki.each(a,function(c){try{uki.dom.handlers[b].elem.detachEvent("on"+c,uki.dom.handlers[b])}catch(d){}})})});(function(){function b(o){if(!e.draggable){e.draggable=
o;uki.dom.bind(p,"mousemove scroll",d);uki.dom.bind(p,k,f);uki.dom.bind(p,"selectstart mousedown",uki.dom.preventDefaultHandler)}}function a(){e.draggable=null;uki.dom.unbind(p,"mousemove scroll",d);uki.dom.unbind(p,k,f);uki.dom.unbind(p,"selectstart mousedown",uki.dom.preventDefaultHandler)}function c(o){o=new uki.dom.Event(o);o.type="draggesturestart";uki.dom.handler.apply(this,arguments);if(!o.isDefaultPrevented()){b(this);e.position=new v(-o.pageX,-o.pageY)}}function d(o){o=new uki.dom.Event(o);
o.type="draggesture";o.dragOffset=(new v(o.pageX,o.pageY)).offset(e.position);uki.dom.handler.apply(e.draggable,arguments);o.isDefaultPrevented()&&a(e.draggable)}function f(o){o=new uki.dom.Event(o);o.type="draggestureend";o.dragOffset=(new v(o.pageX,o.pageY)).offset(e.position);uki.dom.handler.apply(e.draggable,arguments);a(e.draggable)}var e=uki.dom.dnd={draggable:null,nativeDnD:false,position:null};try{if(typeof p.createEvent("MouseEvent").dataTransfer=="object"||p.createEvent("DragEvent").initDragEvent)e.nativeDnD=
true}catch(g){}var j={setup:function(){if(this.__draggesturebound)this.__draggesturebound++;else{this.__draggesturebound=1;uki.dom.bind(this,"mousedown",c);if(!e.nativeDnD&&typeof this.ondragstart=="object")this.ondragstart=function(){event.returnValue=false}}},teardown:function(){this.__draggesturebound--;this.__draggesturebound||uki.dom.unbind(this,"mousedown",c)}};uki.extend(uki.dom.special,{draggesturestart:j,draggestureend:j,draggesture:j});var k="mouseup "+(e.nativeDnD?" dragend":"")})();(function(){function b(h){if(uki.isFunction(h.dom)){if(h.parent().length)return h.dom();
var n=uki.createElement("div","width:1px;height:1px;position:absolute;left:-999em;top:0");p.body.appendChild(n);h.attachTo(n);return n}return h}function a(h){h=new uki.dom.Event(h);var n=h.dataTransfer;h.dataTransfer=new uki.dom.DataTransferWrapper(n);uki.dom.handler.apply(this,arguments);n.effectAllowed=h.dataTransfer.effectAllowed;n.dropEffect=h.dataTransfer.dropEffect}function c(h){uki.dom.bind(h,"draggestureend",j)}function d(h){if(k.dataTransfer){k.dataTransfer.cleanup();k.dragOver=k.dataTransfer=
k.target=null;uki.dom.unbind(h,"draggestureend",j)}}function f(h){if(!(!k.dataTransfer||h.domEvent.__dragEntered||!o)){h=new uki.dom.Event(h);h.domEvent.__dragEntered=true;if(k.dragOver!=this){k.dragOver=this;h.type="dragenter";uki.dom.handler.apply(this,arguments)}}}function e(h){if(o){if(!h.domEvent.__dragEntered&&k.dragOver){h=new uki.dom.Event(h);h.type="dragleave";uki.dom.handler.apply(k.dragOver,arguments);k.dragOver=null}}else{if(k.dataTransfer){h.type="drag";h.target=k.target}else if(h.dragOffset.x>
k.dragDelta||h.dragOffset.y>k.dragDelta){var n=h.target,y=this.parentNode;try{for(;n&&n!=y&&!n.getAttribute("draggable");)n=n.parentNode}catch(w){n=null}if(n&&n.getAttribute("draggable")){k.target=h.target=n;h.type="dragstart";k.dataTransfer=h.dataTransfer=new uki.dom.DataTransfer(h.domEvent.dataTransfer);c(this)}else return}else return;h=new uki.dom.Event(h);uki.dom.handler.apply(this,arguments);h.isDefaultPrevented()?d(this):g(h)}}function g(h){var n=k.dataTransfer._dragImage.style,y=h.domEvent.type;
h.stopPropagation();h.preventDefault();n.left="-999em";n=p.elementFromPoint(h.pageX,h.pageY);k.dataTransfer.update(h);try{var w;o=true;try{if(p.createEventObject){w=p.createEventObject();for(var F=t.length,J;F;){J=uki.dom.props[--F];w[J]=h.domEvent[J]}n.fireEvent("on"+y,w)}else{w=p.createEvent("MouseEvents");w.initMouseEvent(y,true,true,p.defaultView,h.detail,h.screenX,h.screenY,h.clientX,h.clientY,h.ctrlKey,h.altKey,h.shiftKey,h.metaKey,h.button,null);n.dispatchEvent(w)}}catch(N){}o=false}catch(O){}}
function j(h){if(!o)if(k.dataTransfer){h.type="dragend";h.target=k.target;h.dataTransfer=k.dataTransfer;uki.dom.handler.apply(this,arguments);g(h);d(this)}}var k=uki.dom.dnd,o=false;uki.extend(k,{dragDelta:5,initNativeDnD:function(){var h=uki.createElement("div","position: absolute;left:-999em;");p.body.appendChild(h);k.dragImageContainer=h;k.initNativeDnD=uki.F;return true},dragImageContainer:null,dataTransfer:null,target:null,dragOver:null});var l=["dropEffect","effectAllowed","types","files"];
uki.dom.DataTransferWrapper=uki.newClass(new (function(){this.init=function(h){this.dataTransfer=h;for(var n=l.length-1;n>=0;n--)this[l[n]]=h[l[n]]};this.setData=function(h,n){return this.dataTransfer.setData(h,n)};this.clearData=function(h){return this.dataTransfer.clearData(h)};this.getData=function(h){return this.dataTransfer.getData(h)};this.setDragImage=function(h,n,y){k.initNativeDnD();h=b(h);var w=h.cloneNode(true);h=w.style;h.left=h.right=h.top=h.bottom="";h.position="static";k.dragImageContainer.appendChild(w);
setTimeout(function(){k.dragImageContainer.removeChild(w)},1);return this.dataTransfer.setDragImage(w,n,y)}}));uki.dom.DataTransfer=uki.newClass(new (function(){this.init=function(){uki.extend(this,{dropEffect:"none",effectAllowed:"none",types:[],files:[],dragImage:new Image,imagePosition:new v,data:{}})};this.setData=function(h,n){this.data[h]=n;uki.inArray(h,this.types)==-1&&this.types.push(h)};this.clearData=function(h){if(h){delete this.data[h];this.types=uki.grep(this.types,function(n){return n!=
h})}else{this.data={};this.types=[]}};this.getData=function(h){return this.data[h]};this.setDragImage=function(h,n,y){this._dragImage=this._initDragImage(h);this._imagePosition=new v(n||0,y||0)};this.update=function(h){if(this._dragImage){this._dragImage.style.left=h.pageX-this._imagePosition.x+"px";this._dragImage.style.top=h.pageY-this._imagePosition.y+"px"}};this.cleanup=function(){this._dragImage&&this._dragImage.parentNode.removeChild(this._dragImage);this._dragImage=undefined};this._initDragImage=
function(h){h=b(h);h=h.cloneNode(true);var n=h.style;n.left=n.right=n.top=n.bottom="";n.position="absolute";n.left="-999em";n.zIndex="9999";p.body.appendChild(h);return h}}));var m={setup:function(){if(this.__w3cdragbound)this.__w3cdragbound++;else{this.__w3cdragbound=1;uki.dom.bind(this,"draggesture",e)}},teardown:function(){this.__w3cdragbound--;this.__draggesturebound||uki.dom.unbind(this,"draggesture",e)}};if(k.nativeDnD)uki.extend(uki.dom.special,{dragstart:{setup:function(){this.addEventListener("dragstart",
a,false)},teardown:function(){this.removeEventListener("dragstart",a,false)}}});else{uki.extend(uki.dom.special,{dragstart:m,drag:m,dragend:m});uki.each({dragover:"mousemove",drop:"mouseup"},function(h,n){var y=function(w){if(k.dataTransfer&&o){w=new uki.dom.Event(w);w.type=h;w.dataTransfer=k.dataTransfer;if(h=="dragover")k.__canDrop=false;else{d(this);if(!k.__canDrop)return}uki.dom.handler.apply(this,arguments);if(w.isDefaultPrevented())k.__canDrop=true}};uki.dom.special[h]={setup:function(){uki.dom.bind(this,
n,y)},teardown:function(){uki.dom.unbind(this,n,y)}}});uki.dom.special.dragenter={setup:function(){uki.dom.bind(this,"mousemove",f)},teardown:function(){uki.dom.unbind(this,"mousemove",f)}};uki.dom.special.dragleave={setup:function(){},teardown:function(){}}}var t="detail screenX screenY clientX clientY ctrlKey altKey shiftKey metaKey button".split(" ")})();(function(){var b;b=p.documentElement.getBoundingClientRect?(uki.dom.offset=function(a){if(!a||a==u)return new v;if(a===a.ownerDocument.body)return b.bodyOffset(a);
b.boxModel===undefined&&b.initializeBoxModel();var c=a.getBoundingClientRect(),d=a.ownerDocument;a=d.body;d=d.documentElement;return new v(c.left+(b.pageXOffset||b.boxModel&&d.scrollLeft||a.scrollLeft)-(d.clientLeft||a.clientLeft||0),c.top+(b.pageYOffset||b.boxModel&&d.scrollTop||a.scrollTop)-(d.clientTop||a.clientTop||0))}):(uki.dom.offset=function(a){if(!a||a==u)return new v;if(a===a.ownerDocument.body)return b.bodyOffset(a);b.initialized||b.initialize();var c=a.offsetParent,d=a.ownerDocument,f,
e=d.documentElement,g=d.body;d=d.defaultView;f=d.getComputedStyle(a,null);for(var j=a.offsetTop,k=a.offsetLeft;(a=a.parentNode)&&a!==g&&a!==e;){f=d.getComputedStyle(a,null);j-=a.scrollTop;k-=a.scrollLeft;if(a===c){j+=a.offsetTop;k+=a.offsetLeft;if(b.doesNotAddBorder&&!(b.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(a.tagName))){j+=parseInt(f.borderTopWidth,10)||0;k+=parseInt(f.borderLeftWidth,10)||0}c=a.offsetParent}if(b.subtractsBorderForOverflowNotVisible&&f.overflow!=="visible"){j+=parseInt(f.borderTopWidth,
10)||0;k+=parseInt(f.borderLeftWidth,10)||0}f=f}if(f.position==="relative"||f.position==="static"){j+=g.offsetTop;k+=g.offsetLeft}if(f.position==="fixed"){j+=r(e.scrollTop,g.scrollTop);k+=r(e.scrollLeft,g.scrollLeft)}return new v(k,j)});uki.extend(b,{initialize:function(){if(!this.initialized){var a=p.body,c=p.createElement("div"),d,f,e,g=a.style.marginTop;d={position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"};for(f in d)c.style[f]=d[f];c.innerHTML='<div style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;"><div></div></div><table style="position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;" cellpadding="0" cellspacing="0"><tr><td></td></tr></table>';
a.insertBefore(c,a.firstChild);d=c.firstChild;f=d.firstChild;e=d.nextSibling.firstChild.firstChild;this.doesNotAddBorder=f.offsetTop!==5;this.doesAddBorderForTableAndCells=e.offsetTop===5;d.style.overflow="hidden";d.style.position="relative";this.subtractsBorderForOverflowNotVisible=f.offsetTop===-5;a.style.marginTop="1px";this.doesNotIncludeMarginInBodyOffset=a.offsetTop===0;a.style.marginTop=g;a.removeChild(c);this.boxModel===undefined&&this.initializeBoxModel();this.initialized=true}},initializeBoxModel:function(){if(this.boxModel===
undefined){var a=p.createElement("div");a.style.width=a.style.paddingLeft="1px";p.body.appendChild(a);this.boxModel=a.offsetWidth===2;p.body.removeChild(a).style.display="none"}},bodyOffset:function(a){b.initialized||b.initialize();var c=a.offsetTop,d=a.offsetLeft;if(uki.dom.doesNotIncludeMarginInBodyOffset){c+=parseInt(uki.dom.elem.currentStyle(a).marginTop,10)||0;d+=parseInt(uki.dom.elem.currentStyle(a).marginLeft,10)||0}return new v(d,c)}})})();uki.initNativeLayout=function(){uki.supportNativeLayout===
undefined&&uki.dom.probe(uki.createElement("div","position:absolute;width:100px;height:100px;left:-999em;",'<div style="position:absolute;left:0;right:0"></div>'),function(b){uki.supportNativeLayout=b.childNodes[0].offsetWidth==100&&!u.opera})};uki.view={declare:function(){var b=uki.toArray(arguments),a=b.shift();b=uki.newClass.apply(uki,b);var c=a.split("."),d=u,f,e;b.prototype.typeName=function(){return a};for(f=0;f<c.length-1;f++){e=c[f];d[e]||(d[e]={});d=d[e]}return d[c[c.length-1]]=b}};uki.view.Observable=
{bind:function(b,a){a.huid=a.huid||uki.guid++;uki.each(b.split(" "),function(c,d){this._bound(d)||this._bindToDom(d);this._observersFor(d).push(a)},this);return this},unbind:function(b,a){uki.each(b.split(" "),function(c,d){this._observers[d]=!a?[]:uki.grep(this._observersFor(d,true),function(f){return f!=a&&f.huid!=a.huid});this._observers[d].length==0&&this._unbindFromDom(d)},this);return this},trigger:function(b){var a=Array.prototype.slice.call(arguments,1);uki.each(this._observersFor(b,true),
function(c,d){d.apply(this,a)},this);return this},_unbindFromDom:function(b){this._domHander&&this._eventTargets[b]&&uki.dom.unbind(this._eventTargets[b],b,this._domHander)},_bindToDom:function(b,a){if(a||this.dom){this._domHander=this._domHander||uki.proxy(function(c){c.source=this;this.trigger(c.type,c)},this);this._eventTargets=this._eventTargets||{};this._eventTargets[b]=a||this.dom();uki.dom.bind(this._eventTargets[b],b,this._domHander);return true}},_bound:function(b){return this._observers&&
this._observers[b]},_observersFor:function(b,a){if(a&&(!this._observers||!this._observers[b]))return[];if(!this._observers)this._observers={};this._observers[b]||(this._observers[b]=[]);return this._observers[b]}};(function(){function b(){return p.compatMode=="CSS1Compat"&&p.documentElement||p.body}var a=uki.Attachment=uki.newClass(uki.view.Observable,{init:function(c,d,f){uki.initNativeLayout();this._dom=c=c||u;this._view=d;this._rect=q.create(f)||this.rect();uki.dom.offset.initialize();d.parent(this);
this.domForChild().appendChild(d.dom());if(c!=u&&c.tagName!="BODY"){d=c.runtimeStyle||c.ownerDocument.defaultView.getComputedStyle(c,null);if(!d.position||d.position=="static")c.style.position="relative"}a.register(this);this.layout()},domForChild:function(){return this._dom===u?p.body:this._dom},rectForChild:function(){return this.rect()},scroll:function(){},scrollTop:function(){return this._dom.scrollTop||0},scrollLeft:function(){return this._dom.scrollLeft||0},parent:function(){return null},layout:function(){var c=
this._rect,d=this._rect=this.rect();this._view.parentResized(c,d);this._view._needsLayout&&this._view.layout();this.trigger("layout",{source:this,rect:d})},dom:function(){return this._dom},view:function(){return this._view},rect:function(){var c=this._dom===u||this._dom===p.body?r(b().clientWidth,this._dom.offsetWidth||0):this._dom.offsetWidth,d=this._dom===u||this._dom===p.body?r(b().clientHeight,this._dom.offsetHeight||0):this._dom.offsetHeight;return new q(c,d)}});a.instances=[];a.register=function(c){if(a.instances.length==
0){var d=false;uki.dom.bind(u,"resize",function(){if(!d){d=true;setTimeout(function(){d=false;uki.each(a.instances,function(){this.layout()})},1)}})}a.instances.push(c)};a.childViews=function(){return uki.map(a.instances,"view")};uki.top=function(){return[a]}})();uki.Collection=function(b){this.length=0;Array.prototype.push.apply(this,b)};uki.fn=uki.Collection.prototype=new (function(){var b=this;this.each=function(a){uki.each(this,a);return this};this.grep=function(a){return new uki.Collection(uki.grep(this,
a))};this.attr=function(a,c){if(c!==undefined){for(var d=0;d<this.length;d++)uki.attr(this[d],a,c);return this}else return this[0]?uki.attr(this[0],a):""};this.find=function(a){return uki.find(a,this)};this.attachTo=function(a,c){this.each(function(){new uki.Attachment(a,this,c)});return this};this.append=function(a){if(!this[0])return this;a=a.length!==undefined?a:[a];for(var c=0;c<a.length;c++)this[0].appendChild(a[c]);return this};this.appendTo=function(a){a=uki(a)[0];this.each(function(){a.appendChild(this)});
return this};uki.Collection.addAttrs=function(a){uki.each(a,function(c,d){b[d]=function(f){return this.attr(d,f)}})};uki.Collection.addAttrs("dom html text background value rect checked anchors childViews typeName id name visible disabled focusable style draggable textSelectable width height minX maxX minY maxY left top x y".split(" "));uki.each([["parent","parent"],["next","nextView"],["prev","prevView"]],function(a,c){b[c[0]]=function(){return new uki.Collection(uki.unique(uki.map(this,c[1])))}});
uki.each("bind unbind trigger layout appendChild removeChild insertBefore addRow removeRow resizeToContents toggle".split(" "),function(a,c){b[c]=function(){for(var d=0;d<this.length;d++)this[d][c].apply(this[d],arguments);return this}});uki.each(uki.dom.events,function(a,c){b[c]=function(d){if(d)this.bind(c,d);else for(d=0;d<this.length;d++)this[d][c]?this[d][c]():this[d].trigger(c);return this}})});(function(){function b(d){return uki.map(d,function(f){return a(f)})}function a(d){if(uki.isFunction(d.typeName))return d;
var f=d.view||d.type;if(uki.isFunction(f))f=f();else if(typeof f==="string"){var e=f.split("."),g=u;if(!u[e[0]]||e[0]=="Image")e=["uki","view"].concat(e);for(var j=0;j<e.length;j++)g=g[e[j]];if(!g)throw"No view of type "+f+" found";f=new g(d.rect)}else f=f;c(f,d);return f}function c(d,f){uki.each(f,function(e,g){e=="view"||e=="type"||e=="rect"||uki.attr(d,e,g)});return d}uki.build=function(d){if(d.length===undefined)d=[d];return new uki.Collection(b(d))};uki.build.copyAttrs=c})();(function(){function b(l){return a(uki.map(l,
function(m){return[m].concat(b(f(m,"childViews")))}))}function a(l){return uki.reduce([],l,c)}function c(l,m){return l.concat(m)}var d,f=uki.attr,e=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?/g,g=[{name:"ID",regexp:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/},{name:"ATTR",regexp:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/},{name:"TYPE",regexp:/^((?:[\w\u00c0-\uFFFF\*_\.-]|\\.)+)/},{name:"POS",regexp:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/}],
j={first:function(l){return l===0},last:function(l,m,t){return l===t.length-1},even:function(l){return l%2===0},odd:function(l){return l%2===1},lt:function(l,m){return l<m[2]-0},gt:function(l,m){return l>m[2]-0},nth:function(l,m){return m[2]-0==l},eq:function(l,m){return m[2]-0==l}},k={TYPE:function(l,m){m=m[1];if(m=="*")return true;return(l=f(l,"typeName"))&&l.length>=m.length&&("."+l).indexOf("."+m)==l.length-m.length},ATTR:function(l,m){l=f(l,m[1]);var t=l+"",h=m[2];m=m[4];return l==null?h==="!=":
h==="="?t===m:h==="*="?t.indexOf(m)>=0:h==="~="?(" "+t+" ").indexOf(m)>=0:!m?t&&l!==false:h==="!="?t!=m:h==="^="?t.indexOf(m)===0:h==="$="?t.substr(t.length-m.length)===m:false},ID:function(l,m){return k.ATTR(l,["","id","=","",m[1]])},POS:function(l,m,t,h){return(l=j[m[1]])?l(t,m,h):false}},o={"+":function(l){return uki.unique(uki.map(l,"nextView"))},">":function(l){return uki.unique(a(uki.map(l,"childViews")))},"":function(l){return uki.unique(b(a(uki.map(l,"childViews"))))},"~":function(){}};d=
uki.Selector={find:function(l,m,t){m=m||uki.top();if(m.length===undefined)m=[m];var h=d.tokenize(l);l=h[0];h=h[1];for(var n=m,y;l.length>0;){y=o[l[0]]?o[l.shift()]:o[""];n=y(n);if(l.length==0)break;n=d.reduce(l.shift(),n)}if(h)n=n.concat(d.find(h,m,true));return t?n:new uki.Collection(uki.unique(n))},reduce:function(l,m){if(!m||!m.length)return[];for(var t,h;l!="";){h=false;uki.each(g,function(n,y){if(t=l.match(y.regexp)){h=true;m=uki.grep(m,function(w,F){return k[y.name](w,t,F,m)});l=l.replace(y.regexp,
"");return false}});if(!h)break}return m},tokenize:function(l){var m=[],t,h;for(e.lastIndex=0;(t=e.exec(l))!==null;){m.push(t[1]);if(t[2]){h=RegExp.rightContext;break}}return[m,h]}};uki.find=d.find})();uki.image=function(b,a,c){var d=new Image;d.src=uki.imageSrc(b,a,c);return d};uki.imageSrc=function(b,a,c){if(uki.image.dataUrlSupported&&a)return a;if(c&&uki.image.needAlphaFix)return c;return b};uki.imageHTML=function(b,a,c,d){if(uki.image.needAlphaFix&&c)b=c;else if(uki.image.dataUrlSupported)b=
a;return"<img"+(d||"")+' src="'+b+'" />'};uki.image.load=function(b,a){var c=b.length;uki.each(b,function(d,f){if(!f||f.width)--c||a();else{d=function(){f.onload=f.onerror=f.onabort=null;--c||a()};f.onload=d;f.onerror=d;f.onabort=d}})};uki.image.dataUrlSupported=p.createElement("canvas").toDataURL||/MSIE (8)/.test(A);uki.image.needAlphaFix=/MSIE 6/.test(A);uki.image.needAlphaFix&&p.execCommand("BackgroundImageCache",false,true);(function(){var b=/^\s*null\s*$/,a=/theme\s*\(\s*([^)]*\s*)\)/,c=/rows\s*\(\s*([^)]*\s*)\)/,
d=/cssBox\s*\(\s*([^)]*\s*)\)/,f=uki.background=function(e){if(typeof e==="string"){var g;if(e.match(b))return new f.Null;if(g=e.match(a))return uki.theme.background(g[1]);if(g=e.match(c))return new f.Rows(g[1].split(",")[0],g[1].split(/\s*,\s*/).slice(1));if(g=e.match(d))return new f.CssBox(g[1]);return new f.Css(e)}return e}})();uki.background.Base=uki.background.Null=uki.newClass({init:uki.F,attachTo:uki.F,detach:uki.F});uki.background.Sliced9=uki.newClass(new (function(){function b(e,g,j,k,o){k=
j[3]?c(j,k):"";j[3]||(g+=a(j,o));return'<div class="'+e+'" style="position:absolute;overflow:hidden;'+g+'">'+k+"</div>"}function a(e,g){return";background: url("+uki.imageSrc(e[0],e[1],e[2])+") "+g}function c(e,g){return uki.imageHTML(e[0],e[1],e[2],' ondragstart="return false;" galleryimg="no" style="-webkit-user-drag:none;-webkit-user-select:none;-moz-user-select:none;position:absolute;'+g+'"')}var d=uki.dom,f={};this.init=function(e,g,j){this._settings=uki.extend({},e);this._inset=x.create(g);
this._size=null;this._inited=false;j=j||{};this._fixedSize=s.create(j.fixedSize)||new s;this._bgInset=x.create(j.inset)||new x;this._zIndex=j.zIndex||-1;this._container=this._getContainer();this._container.style.zIndex=this._zIndex};this._getContainer=function(){var e=this._getKey();if(!f[e])return f[e]=this._createContainer();return f[e].cloneNode(true)};this._createContainer=function(){var e=this._inset,g=this._bgInset,j=this._settings,k=e.left+e.right,o=e.top+e.bottom;g=["left:"+g.left+"px","right:"+
g.right+"px","top:"+g.top+"px","bottom:"+g.bottom+"px"].join(";");var l=[];if(e.top&&e.left)l[l.length]=b("tl",["left:0;top:0","width:"+e.left+"px","height:"+e.top+"px"].join(";"),j.c,["left:0;top:0","width:"+k+"px","height:"+o+"px"].join(";"),"top left");if(e.top)l[l.length]=b("t",["left:"+e.left+"px","top:0","height:"+e.top+"px","right:"+e.right+"px"].join(";"),j.h,["left:0;top:0;width:100%","height:"+o+"px"].join(";"),"repeat-x top");if(e.top&&e.right)l[l.length]=b("tr",["right:0;top:0","width:"+
e.right+"px","height:"+e.top+"px"].join(";"),j.c,["left:-"+e.left+"px","top:0","width:"+k+"px","height:"+o+"px"].join(";"),"top right");if(e.left)l[l.length]=b("l",["left:0","top:"+e.top+"px","width:"+e.left+"px","bottom:"+e.bottom+"px"].join(";"),j.v,["left:0;top:0;height:100%","width:"+k+"px"].join(";"),"repeat-y left");if(j.m)l[l.length]=b("m",["left:"+e.left+"px","top:"+e.top+"px","right:"+e.right+"px","bottom:"+e.bottom+"px"].join(";"),j.m,"left:0;top:0;height:100%;width:100%","");if(e.right)l[l.length]=
b("r",["right:0","top:"+e.top+"px","width:"+e.right+"px","bottom:"+e.bottom+"px"].join(";"),j.v,["left:-"+e.left+"px","top:0;height:100%","width:"+k+"px"].join(";"),"repeat-y right");if(e.bottom&&e.left)l[l.length]=b("bl",["left:0;bottom:0","width:"+e.left+"px","height:"+e.bottom+"px"].join(";"),j.c,["left:0","top:-"+e.top+"px","width:"+k+"px","height:"+o+"px"].join(";"),"left -"+e.top+"px");if(e.bottom)l[l.length]=b("b",["left:"+e.left+"px","bottom:0","height:"+e.bottom+"px","right:"+e.right+"px"].join(";"),
j.h,["left:0","top:-"+e.top+"px","width:100%","height:"+o+"px"].join(";"),"repeat-x 0 -"+e.top+"px");if(e.bottom&&e.right)l[l.length]=b("br",["right:0;bottom:0","width:"+e.right+"px","height:"+e.bottom+"px"].join(";"),j.c,["left:-"+e.left+"px","top:-"+e.top+"px","width:"+k+"px","height:"+o+"px"].join(";"),"right -"+e.top+"px");return uki.createElement("div","position:absolute;overflow:hidden;"+g,l.join(""))};this._getKey=function(){return uki.map(["v","h","m","c"],function(e){return this._settings[e]&&
this._settings[e][0]||""},this).concat([this._inset,this._bgInset,this._fixedSize]).join(",")};this.attachTo=function(e){this._comp=e;this._container.style.visibility="visible";this._comp.dom().appendChild(this._container);if(!uki.supportNativeLayout){this._layoutHandler=this._layoutHandler||uki.proxy(function(g){if(!(this._size&&this._size.eq(g.rect))){this._size=g.rect;this.layout()}},this);this._comp.bind("layout",this._layoutHandler);this.layout()}};this.detach=function(){if(this._comp){this._container.style.visibility=
"hidden";uki.supportNativeLayout||this._comp.unbind("layout",this._layoutHandler);this._size=this._comp=null;this._attached=this._inited=false}};this.layout=function(){var e=this._comp.rect(),g=this._parts,j=this._inset,k=this._bgInset,o=this._fixedSize,l=G(o.width||e.width-k.left-k.right);e=G(o.height||e.height-k.top-k.bottom);k=j.left+j.right;j=j.top+j.bottom;if(!g){g={};uki.each(this._container.childNodes,function(){if(this.className)g[this.className]=this});this._parts=g}g.t&&d.layout(g.t.style,
{width:l-k});g.b&&d.layout(g.b.style,{width:l-k});g.l&&d.layout(g.l.style,{height:e-j});g.r&&d.layout(g.r.style,{height:e-j});g.m&&d.layout(g.m.style,{height:e-j,width:l-k});d.layout(this._container.style,{width:l,height:e})}}));uki.background.Css=uki.newClass(new (function(){this.init=function(b){this._options=typeof b=="string"?{background:b}:b};this.attachTo=function(b){this._comp=b;this._originalValues={};uki.each(this._options,function(a,c){this._originalValues[a]=b.style(a);b.style(a,c)},this)};
this.detach=function(){this._comp&&uki.each(this._options,function(b){this._comp.style(b,this._originalValues[b])},this)}}));uki.background.CssBox=uki.newClass(new (function(){function b(c){a[c]||uki.dom.probe(uki.createElement("div",c+";position:absolute;overflow:hidden;left:-999em;width:10px;height:10px;"),function(d){a[c]=new x(d.offsetHeight-10,d.offsetWidth-10)});return a[c]}var a={};this.init=function(c,d){this._options=c;d=d||{};this._inset=inset=x.create(d.inset)||new x;this._insetWidth=b(c).left+
inset.left+inset.right;this._insetHeight=b(c).top+inset.top+inset.bottom;this._container=uki.createElement("div",c+";position:absolute;overflow:hidden;z-index:"+(d.zIndex||"-1")+";left:"+inset.left+";top:"+inset.top+"px;right:"+inset.right+"px;bottom:"+inset.bottom+"px",d.innerHTML);this._attached=false};this.attachTo=function(c){this._comp=c;this._comp.dom().appendChild(this._container);if(!uki.supportNativeLayout){this._layoutHandler=this._layoutHandler||uki.proxy(function(d){this.layout(d.rect)},
this);this._comp.bind("layout",this._layoutHandler);this.layout(this._comp.rect())}};this.layout=function(c){this._prevLayout=uki.dom.layout(this._container.style,{width:c.width-this._insetWidth,height:c.height-this._insetHeight},this._prevLayout)};this.detach=function(){if(this._comp){this._comp.dom().removeChild(this._container);uki.supportNativeLayout||this._comp.unbind("layout",this._layoutHandler);this._attached=false}}}));uki.background.Rows=uki.newClass(new (function(){function b(d,f){var e=
d+" "+f.join(" "),g=[],j=[],k,o=f.length;if(!a[e]){for(k=0;k<o;k++)g[k]=['<div style="height:',d,"px;width:100%;overflow:hidden;",f[k]?"background:"+f[k]:"",'"></div>'].join("");for(k=0;k<c;k++)j[k]=g[k%o];a[e]=j.join("")}return a[e]}var a=[],c=100;this.init=function(d,f){this._height=d||20;this._colors=uki.isArray(f)?f:f.split(" ");this._packSize=E(c/this._colors.length)*this._colors.length;this._renderedHeight=0;this._visibleExt=200;if(this._colors.length==1)this._colors=this._colors.concat(["#FFF"])};
this.attachTo=function(d){this._comp&&this.detach();this._comp=d;if(!this._container)this._container=uki.createElement("div","position:absolute;left:0;top:0;width:100%;z-index:-1");this._layoutHandler=this._layoutHandler||uki.proxy(function(f){this.layout(f.rect,f.visibleRect)},this);this._comp.dom().appendChild(this._container);this._comp.bind("layout",this._layoutHandler)};this.layout=function(d,f){for(d=f?f.height+this._visibleExt*2:d.maxY();this._renderedHeight<d;){var e=c*this._height,g=uki.createElement("div",
"height:"+e+"px;overflow:hidden;width:100%;",b(this._height,this._colors));this._renderedHeight+=e;this._container.appendChild(g)}if(f)this._container.style.top=E((f.y-this._visibleExt)/this._height/this._colors.length)*this._height*this._colors.length+"px"};this.detach=function(){if(this._comp){this._comp.dom().removeChild(this._container);this._comp.unbind("layout",this._layoutHandler);this._comp=null}}}));uki.background.Multi=uki.newClass({init:function(){this._bgs=Array.prototype.slice.call(arguments,
0)},attachTo:function(b){for(var a=0;a<this._bgs.length;a++)this._bgs[a].attachTo(b)},detach:function(){for(var b=0;b<this._bgs.length;b++)this._bgs[b].detach()}});uki.theme={themes:[],register:function(b){uki.theme.themes.push(b)},background:function(b,a){return uki.theme._namedResource(b,"background",a)||new uki.background.Null},image:function(b,a){return uki.theme._namedResource(b,"image",a)||new Image},imageSrc:function(b,a){return uki.theme._namedResource(b,"imageSrc",a)||""},style:function(b,
a){return uki.theme._namedResource(b,"style",a)||""},dom:function(b,a){return uki.theme._namedResource(b,"dom",a)||uki.createElement("div")},template:function(b,a){return uki.theme._namedResource(b,"template",a)||""},_namedResource:function(b,a,c){for(var d=uki.theme.themes.length-1;d>=0;d--){var f=uki.theme.themes[d][a](b,c);if(f)return f}return null}};uki.theme.Base={images:[],imageSrcs:[],backgrounds:[],doms:[],styles:[],templates:[],background:function(b,a){return this.backgrounds[b]&&this.backgrounds[b](a)},
image:function(b,a){if(this.images[b])return this.images[b](a);return this.imageSrcs[b]&&uki.image.apply(uki,this.imageSrcs[b](a))},imageSrc:function(b,a){if(this.imageSrcs[b])return uki.imageSrc.apply(uki,this.imageSrcs[b](a));return this.images[b]&&this.images[b](a).src},dom:function(b,a){return this.doms[b]&&this.doms[b](a)},style:function(b,a){return this.styles[b]&&this.styles[b](a)},template:function(b,a){return this.templates[b]&&this.templates[b](a)}};uki.theme.Template=function(b){b=b.split("${");
var a,c,d;this.parts=[b[0]];this.names=[];a=1;for(c=b.length;a<c;a++){d=b[a].split("}");this.names.push(d.shift());this.parts.push("");this.parts.push(d.join("}"))}};uki.theme.Template.prototype.render=function(b){for(var a=0,c=this.names,d=c.length;a<d;a++)this.parts[a*2+1]=b[c[a]]||"";return this.parts.join("")};uki.view.utils=new (function(){function b(a){return a.visibleRect?a.visibleRect():a.rect().clone()}this.visibleRect=function(a,c){var d=[],f,e=a;do{d[d.length]=e;e=e.parent()}while(e&&e!=
c);if(c&&c!=a)d[d.length]=c;for(a=d.length-1;a>=0;a--){e=d[a];c=b(e);f=f?f.intersection(c):c;f.x-=e.rect().x;f.y-=e.rect().y}return f};this.top=function(a){for(;a.parent();)a=a.parent();return a};this.offset=function(a,c){for(var d=new v,f;a&&a!=c;){f=a.rect();d.x+=f.x;d.y+=f.y;if(a.scrollTop){d.x-=a.scrollLeft();d.y-=a.scrollTop()}a=a.parent()}return d};this.scrollableParent=function(a){do{if(uki.isFunction(a.scrollTop))return a;a=a.parent()}while(a);return null}});uki.extend(uki.view,uki.view.utils);
uki.view.Styleable=new (function(){this.style=function(a,c){if(typeof a=="string")return this._style(a,c);uki.each(a,function(d,f){this._style(d,f)},this);return this};this._style=function(a,c){if(c===undefined)return this._dom.style[a];this._dom.style[a]=c;return this};var b=uki.createElement("div").style;uki.each(["userSelect","MozUserSelect","WebkitUserSelect"],function(a,c){if(typeof b[c]=="string")this._textSelectProp=c},this);this.textSelectable=function(a){if(a===undefined)return this._textSelectable;
this._textSelectable=a;if(this._textSelectProp)this._dom.style[this._textSelectProp]=a?"":this._textSelectProp=="MozUserSelect"?"-moz-none":"none";else uki.dom[a?"unbind":"bind"](this.dom(),"selectstart",uki.dom.preventDefaultHandler);this._dom.style.cursor=a?"":"default";return this};this.draggable=function(a){if(a===undefined)return this._dom.getAttribute("draggable");this._dom.setAttribute("draggable",true);this._dom.style.WebkitUserDrag="element";return this}});uki.view.Focusable=new (function(){this._focusOnClick=
this._focusable=true;this.focusOnClick=uki.newProp("_focusOnClick");this.focusable=uki.newProp("_focusable",function(b){(this._focusable=b)&&this._initFocusable();this._updateFocusable()});this.disabled=uki.newProp("_disabled",function(b){var a=b!==!!this._disabled;(this._disabled=b)&&this.blur();this._updateFocusable();a&&this._updateBg&&this._updateBg()});this._updateFocusable=function(){if(!(this._preCreatedFocusTarget||!this._focusTarget))this._focusTarget.style.display=this._focusable&&!this._disabled?
"block":"none"};this._initFocusable=function(b){if(!(!b&&!this._focusable||this._focusTarget)){this._preCreatedFocusTarget=this._focusTarget=b;if(!b){this._focusTarget=uki.createElement("input","position:absolute;left:-9999px;top:0;width:1px;height:1px;");this.dom().appendChild(this._focusTarget)}this._hasFocus=false;this._firstFocus=true;uki.dom.bind(this._focusTarget,"focus",uki.proxy(function(a){this._hasFocus||this._focus(a)},this));uki.dom.bind(this._focusTarget,"blur",uki.proxy(function(){if(this._hasFocus){this._hasFocus=
false;setTimeout(uki.proxy(function(){this._hasFocus||this._blur()},this),1)}},this));b||this.bind("mousedown",function(){this._focusOnClick&&this.focus()});this._updateFocusable()}};this._focus=function(){this._hasFocus=true;this._firstFocus=false};this._blur=function(){this._hasFocus=false};this.focus=function(){if(this._focusable&&!this._disabled){this._hasFocus||this._focus();var b=this._focusTarget;setTimeout(function(){try{b.focus()}catch(a){}b=null},1)}return this};this.blur=function(){try{this._focusTarget.blur()}catch(b){}return this};
this.hasFocus=function(){return this._hasFocus};this._bindToDom=function(b){if(!this._focusTarget||"keyup keydown keypress focus blur".indexOf(b)==-1)return false;return uki.view.Observable._bindToDom.call(this,b,this._focusTarget)}});var B=16,C=32;uki.view.declare("uki.view.Base",uki.view.Observable,uki.view.Styleable,function(){function b(c){if(!c)return 0;var d=0;if(c.indexOf("width")>-1)d|=B;if(c.indexOf("height")>-1)d|=C;return d}var a=1;this.defaultCss="position:absolute;z-index:100;-moz-user-focus:none;font-family:Arial,Helvetica,sans-serif;";
this.init=function(c){this._parentRect=this._rect=q.create(c);this._setup();uki.initNativeLayout();this._createDom()};this._setup=function(){uki.extend(this,{_anchors:0,_parent:null,_visible:true,_needsLayout:true,_textSelectable:false,_styleH:"left",_styleV:"top",_firstLayout:true})};this.dom=function(){return this._dom};this.id=function(c){if(c===undefined)return this._dom.id;this._dom.id&&uki.unregisterId(this);this._dom.id=c;uki.registerId(this);return this};uki.delegateProp(this,"className",
"_dom");this.visible=function(c){if(c===undefined)return this._dom.style.display!="none";this._dom.style.display=c?"block":"none";return this};this.background=function(c){if(c===undefined&&!this._background&&this.defaultBackground)this._background=this.defaultBackground();if(c===undefined)return this._background;c=uki.background(c);if(c==this._background)return this;this._background&&this._background.detach(this);c.attachTo(this);this._background=c;return this};this.defaultBackground=function(){return this._defaultBackground&&
uki.background(this._defaultBackground)};this.parent=function(c){if(c===undefined)return this._parent;this._parent=c;return this};this.childViews=function(){return[]};this.prevView=function(){if(!this.parent())return null;return this.parent().childViews()[this._viewIndex-1]||null};this.nextView=function(){if(!this.parent())return null;return this.parent().childViews()[this._viewIndex+1]||null};this.rect=function(c){if(c===undefined)return this._rect;this._parentRect=c=q.create(c);this._rect=this._normalizeRect(c);
this._needsLayout=this._needsLayout||a++;return this};this.anchors=uki.newProp("_anchors",function(c){if(c.indexOf){var d=0;if(c.indexOf("right")>-1)d|=2;if(c.indexOf("bottom")>-1)d|=4;if(c.indexOf("top")>-1)d|=1;if(c.indexOf("left")>-1)d|=8;if(c.indexOf("width")>-1||d&8&&d&2)d|=B;if(c.indexOf("height")>-1||d&4&&d&1)d|=C;c=d}this._anchors=c;this._styleH=c&8?"left":"right";this._styleV=c&1?"top":"bottom"});this.rectForChild=function(){return this.rect()};this.layout=function(){this._layoutDom(this._rect);
this._needsLayout=false;this.trigger("layout",{rect:this._rect,source:this});this._firstLayout=false};uki.each(["min","max"],function(c,d){c=d+"Size";var f="_"+c;this[c]=function(e){if(e===undefined)return this[f]||new s;this[f]=s.create(e);this.rect(this._parentRect);this._dom.style[d+"Width"]=this[f].width?this[f].width+"px":"";this._dom.style[d+"Height"]=this[f].height?this[f].height+"px":"";return this}},this);this.parentResized=function(c,d){var f=this._parentRect.clone(),e=(d.width-c.width)/
((this._anchors&8^8?1:0)+(this._anchors&B?1:0)+(this._anchors&2^2?1:0));c=(d.height-c.height)/((this._anchors&1^1?1:0)+(this._anchors&C?1:0)+(this._anchors&4^4?1:0));if(this._anchors&8^8)f.x+=e;if(this._anchors&B)f.width+=e;if(this._anchors&1^1)f.y+=c;if(this._anchors&C)f.height+=c;this.rect(f)};this.resizeToContents=function(c){c=b(c);if(0==c)return this;this.rect();this._rect=this._parentRect=this._calcRectOnContentResize(c);this._needsLayout=true;return this};this.contentsSize=function(){return this.rect()};
this._normalizeRect=function(c){if(this._minSize)c=new q(c.x,c.y,r(this._minSize.width,c.width),r(this._minSize.height,c.height));if(this._maxSize)c=new q(c.x,c.y,z(this._maxSize.width,c.width),z(this._maxSize.height,c.height));return c};this._initBackgrounds=function(){this.background()&&this.background().attachTo(this)};this._calcRectOnContentResize=function(c){var d=this.contentsSize(c),f=this.rect();if(d.eq(f))return f;var e=this.rect().clone(),g=d.width-f.width;d=d.height-f.height;if(c&B){if(this._anchors&
8^8&&this._anchors&2^2)e.x-=g/2;else if(this._anchors&8^8)e.x-=g;e.width+=g}if(c&C){if(this._anchors&1^1&&this._anchors&4^4)e.y-=d/2;else if(this._anchors&1^1)e.y-=d;e.height+=d}return e};uki.each(["width","height","minX","maxX","minY","maxY","x","y","left","top"],function(c,d){this[d]=function(f){if(f===undefined)return uki.attr(this.rect(),d);uki.attr(this.rect(),d,f);return this}},this);this._createDom=function(){this._dom=uki.createElement("div",this.defaultCss)};this._layoutDom=function(c){var d=
{},f=uki.supportNativeLayout,e=this.parent().rectForChild(this);if(f&&this._anchors&8&&this._anchors&2){d.left=c.x;d.right=e.width-c.x-c.width}else{d.width=c.width;d[this._styleH]=this._styleH=="left"?c.x:e.width-c.x-c.width}if(f&&this._anchors&1&&this._anchors&4){d.top=c.y;d.bottom=e.height-c.y-c.height}else{d.height=c.height;d[this._styleV]=this._styleV=="top"?c.y:e.height-c.y-c.height}this._lastLayout=uki.dom.layout(this._dom.style,d,this._lastLayout);this._firstLayout&&this._initBackgrounds();
return true};this._bindToDom=function(c){if("resize layout".indexOf(c)>-1)return true;return uki.view.Observable._bindToDom.call(this,c)}});uki.view.declare("uki.view.Container",uki.view.Base,function(b){function a(c,d){var f=0,e;for(e=c._childViews.length-1;e>=0;e--)if(c._childViews[e].visible())f=r(f,c._childViews[e].rect()[d]());return f}this._setup=function(){this._childViews=[];b._setup.call(this)};this.contentsWidth=function(){return a(this,"maxX")};this.contentsHeight=function(){return a(this,
"maxY")};this.contentsSize=function(){return new s(this.contentsWidth(),this.contentsHeight())};this.childViews=function(c){if(c===undefined)return this._childViews;uki.each(this._childViews,function(d,f){this.removeChild(f)},this);uki.each(uki.build(c),function(d,f){this.appendChild(f)},this);return this};this.removeChild=function(c){c.parent(null);this.domForChild(c).removeChild(c.dom());var d,f;d=c._viewIndex+1;for(f=this._childViews.length;d<f;d++)this._childViews[d]._viewIndex--;this._childViews=
uki.grep(this._childViews,function(e){return e!=c})};this.appendChild=function(c){c._viewIndex=this._childViews.length;this._childViews.push(c);c.parent(this);this.domForChild(c).appendChild(c.dom())};this.insertBefore=function(c,d){var f,e;f=c._viewIndex=d._viewIndex;for(e=this._childViews.length;f<e;f++)this._childViews[f]._viewIndex++;this._childViews.splice(d._viewIndex-1,0,c);c.parent(this);this.domForChild(c).insertBefore(c.dom(),d.dom())};this.domForChild=function(){return this._dom};this._layoutDom=
function(c){b._layoutDom.call(this,c);this._layoutChildViews(c)};this._layoutChildViews=function(){for(var c=0,d=this.childViews();c<d.length;c++)d[c]._needsLayout&&d[c].visible()&&d[c].layout(this._rect)};this.rect=function(c){if(c===undefined)return this._rect;this._parentRect=c=q.create(c);var d=this._rect;if(!this._resizeSelf(c))return this;this._needsLayout=true;if(d.width!=c.width||d.height!=c.height)this._resizeChildViews(d);this.trigger("resize",{oldRect:d,newRect:this._rect,source:this});
return this};this._resizeSelf=function(c){this._rect=this._normalizeRect(c);return true};this._resizeChildViews=function(c){for(var d=0,f=this.childViews();d<f.length;d++)f[d].parentResized(c,this._rect)}});uki.view.declare("uki.view.Box",uki.view.Container,{});uki.view.declare("uki.view.Image",uki.view.Base,function(){this.typeName=function(){return"uki.view.Image"};uki.delegateProp(this,"src","_dom");this._createDom=function(){this._dom=uki.createElement("img",this.defaultCss)}});uki.view.declare("uki.view.Label",
uki.view.Base,function(b){this._setup=function(){b._setup.call(this);uki.extend(this,{_scrollable:false,_textSelectable:false,_inset:new x})};this._style=function(a,c){if(c!==undefined&&"font fontFamily fontWeight fontSize textDecoration color".indexOf(a)!=-1)this._label.style[a]=c;return b._style.call(this,a,c)};this.textSelectable=function(a){if(a!==undefined&&!this._textSelectProp)this._label.unselectable=a?"":"on";return b.textSelectable.call(this,a)};this.contentsSize=function(a){var c=this._createLabelClone(a),
d=this.inset(),f;uki.dom.probe(c,function(){f=new s(c.offsetWidth+d.width(),c.offsetHeight+d.height())});return f};this.text=function(a){return a===undefined?this.html():this.html(uki.escapeHTML(a))};this.html=function(a){if(a===undefined)return this._label.innerHTML;this._label.innerHTML=a;return this};this.inset=uki.newProp("_inset",function(a){this._inset=x.create(a)});this.scrollable=uki.newProp("_scrollable",function(a){this._scrollable=a;this._label.style.overflow=a?"auto":"hidden"});this.multiline=
uki.newProp("_multiline",function(a){this._multiline=a;this._label.style.whiteSpace=a?"":"nowrap"});this._createLabelClone=function(a){var c=this._label.cloneNode(true),d=this.inset(),f=this.rect();if(a&B)c.style.width=c.style.right="";else if(uki.supportNativeLayout){c.style.right="";c.style.width=f.width-d.width()+"px"}if(a&C)c.style.height=c.style.bottom="";else if(uki.supportNativeLayout){c.style.bottom="";c.style.height=f.height-d.height()+"px"}c.style.paddingTop=0;c.style.visibility="hidden";
return c};this._createDom=function(){b._createDom.call(this);this._label=uki.createElement("div",b.defaultCss+"font-size:12px;white-space:nowrap;");this._dom.appendChild(this._label);this.textSelectable(this.textSelectable())};this._layoutDom=function(){b._layoutDom.apply(this,arguments);var a=this._inset;if(!this.multiline()){parseInt(this.style("fontSize"),10);this._label.style.lineHeight=this._rect.height-a.top-a.bottom+"px"}a=uki.supportNativeLayout?{left:a.left,top:a.top,right:a.right,bottom:a.bottom}:
{left:a.left,top:a.top,width:this._rect.width-a.width(),height:this._rect.height-a.height()};this._lastLabelLayout=uki.dom.layout(this._label.style,a,this._lastLabelLayout)}});uki.view.declare("uki.view.Button",uki.view.Label,uki.view.Focusable,function(b,a){this._backgroundPrefix="button-";this._setup=function(){b._setup.call(this);uki.extend(this,{_inset:new x(0,4),defaultCss:b.defaultCss+"cursor:default;-moz-user-select:none;-webkit-user-select:none;"})};uki.addProps(this,["backgroundPrefix"]);
uki.each(["normal","hover","down","focus","disabled"],function(c,d){var f=d+"-background";this[f]=function(e){if(e)this["_"+f]=e;return this["_"+f]=this["_"+f]||uki.theme.background(this._backgroundPrefix+d,{height:this.rect().height,view:this})}},this);this._createLabelClone=function(c){return b._createLabelClone.call(this,c)};this._layoutDom=function(c){b._layoutDom.call(this,c);if(this._firstLayout){this["hover-background"]();this["down-background"]();this._backgroundByName(this._backgroundName||
"normal")}};this._updateBg=function(){this._backgroundByName(this._disabled?"disabled":this._down?"down":this._over?"hover":"normal")};this._createDom=function(){this._dom=uki.createElement("div",this.defaultCss+"color:#333;text-align:center;");this._label=uki.createElement("div",b.defaultCss+"font-size:12px;line-height:12px;white-space:nowrap;");this._dom.appendChild(this._label);this.style("fontWeight","bold");this._dom.appendChild(uki.createElement("div","left:0;top:0;width:100%;height:100%;position:absolute;background:url("+
uki.theme.imageSrc("x")+");"));this.textSelectable(this.textSelectable());this._initFocusable();uki.dom.bind(document,"mouseup",uki.proxy(this._mouseup,this));this.bind("mousedown",this._mousedown);this.bind("mouseenter",this._mouseenter);this.bind("mouseleave",this._mouseleave);this.bind("keyup",this._keyup);this.bind("keydown",this._keydown)};this._mouseup=function(){if(this._down){this._down=false;this._updateBg()}};this._mousedown=function(){this._down=true;this._updateBg()};this._mouseenter=
function(){this._over=true;this._updateBg()};this._mouseleave=function(){this._over=false;this._updateBg()};this._focus=function(c){this["focus-background"]().attachTo(this);a._focus.call(this,c)};this._keydown=function(c){if((c.which==32||c.which==13)&&!this._down)this._mousedown()};this._keyup=function(c){if((c.which==32||c.which==13)&&this._down){this._mouseup();this.trigger("click",{domEvent:c,source:this})}c.which==27&&this._down&&this._mouseup()};this._blur=function(c){this["focus-background"]().detach();
a._blur.call(this,c)};this._backgroundByName=function(c){var d=this[c+"-background"]();if(this._background!=d){this._background&&this._background.detach();d.attachTo(this);this._background=d;this._backgroundName=c}};this._bindToDom=function(c){return uki.view.Focusable._bindToDom.call(this,c)||uki.view.Label.prototype._bindToDom.call(this,c)}});uki.view.declare("uki.view.Checkbox",uki.view.Button,function(b){this._backgroundPrefix="checkbox-";uki.each(["checked-normal","checked-hover","checked-disabled"],
function(a,c){var d=c+"-background";this[d]=function(f){if(f)this["_"+d]=f;return this["_"+d]=this["_"+d]||uki.theme.background(this._backgroundPrefix+c,{height:this.rect().height,view:this})}},this);this._setup=function(){b._setup.call(this);this._focusable=false};this._updateBg=function(){var a=this._disabled?"disabled":this._over?"hover":"normal";if(this._checked)a="checked-"+a;this._backgroundByName(a)};this.value=this.checked=uki.newProp("_checked",function(a){var c=this._checked!=!!a;this._checked=
!!a;this._updateBg();c&&this.trigger("change",{checked:this._checked,source:this})});this._mouseup=function(){if(this._down){this._down=false;this._disabled||this.checked(!this.checked())}}});(function(){var b=uki.view.declare("uki.view.Radio",uki.view.Checkbox,function(){this._backgroundPrefix="radio-";this.group=uki.newProp("_group",function(a){b.unregisterGroup(this);this._group=a;b.registerGroup(this);b.clearGroup(this)});this.value=this.checked=uki.newProp("_checked",function(a){var c=this._checked!=
!!a;this._checked=!!a;a&&b.clearGroup(this);this._updateBg();c&&this.trigger("change",{checked:this._checked,source:this})});this._mouseup=function(){if(this._down){this._down=false;!this._checked&&!this._disabled&&this.checked(!this._checked)}}});b.groups={};b.registerGroup=function(a){var c=a.group();if(b.groups[c])b.groups[c].push(a);else b.groups[c]=[a]};b.unregisterGroup=function(a){var c=a.group();if(b.groups[c])b.groups[c]=uki.grep(b.groups[c],function(d){return d!=a})};b.clearGroup=function(a){uki.each(b.groups[a.group()]||
[],function(c,d){d!=a&&d.checked()&&d.checked(false)})}})();uki.view.declare("uki.view.TextField",uki.view.Base,uki.view.Focusable,function(b,a){function c(e){if(!f[e]){var g=uki.createElement("input",b.defaultCss+"border:none;padding:0;border:0;overflow:hidden;font-size:"+e+";left:-999em;top:0");uki.dom.probe(g,function(j){f[e]=j.offsetHeight})}return f[e]}function d(e){return typeof e.placeholder=="string"}var f={};this._setup=function(){b._setup.apply(this,arguments);uki.extend(this,{_value:"",
_multiline:false,_placeholder:"",_backgroundPrefix:"",defaultCss:b.defaultCss+"margin:0;border:none;outline:none;padding:0;font-size:11px;left:2px;top:0;z-index:100;resize:none;background: url("+uki.theme.imageSrc("x")+")"})};this._updateBg=function(){this._input.style.color=this._disabled?"#999":"#000"};this.value=function(e){if(e===undefined)return this._input.value;this._input.value=e;this._updatePlaceholderVis();return this};this.placeholder=uki.newProp("_placeholder",function(e){this._placeholder=
e;if(!this._multiline&&d(this._input))this._input.placeholder=e;else if(this._placeholderDom)this._placeholderDom.innerHTML=e;else{this._placeholderDom=uki.createElement("div",this.defaultCss+"z-input:103;color:#999;cursor:text;-moz-user-select:none;",e);this._dom.appendChild(this._placeholderDom);this._updatePlaceholderVis();uki.each(["fontSize","fontFamily","fontWeight"],function(g,j){this._placeholderDom.style[j]=this.style(j)},this);uki.dom.bind(this._placeholderDom,"mousedown",uki.proxy(function(g){this.focus();
g.preventDefault()},this))}});this._style=function(e,g){if(g===undefined)return this._input.style[e];this._input.style[e]=g;if(this._placeholderDom)this._placeholderDom.style[e]=g;return this};uki.addProps(this,["backgroundPrefix"]);this.defaultBackground=function(){return uki.theme.background(this._backgroundPrefix+"input")};this._createDom=function(){var e=this._multiline?"textarea":"input";this._dom=uki.createElement("div",b.defaultCss+";cursor:text;overflow:visible");this._input=uki.createElement(e,
this.defaultCss+(this._multiline?"":";overflow:hidden;"));this._input.value=this._value;this._dom.appendChild(this._input);this._input.value=this.value();this._initFocusable(this._input);this.bind("mousedown",function(g){g.target!=this._input&&this.focus()})};this._layoutDom=function(){b._layoutDom.apply(this,arguments);uki.dom.layout(this._input.style,{width:this._rect.width-4});var e;if(this._multiline){this._input.style.height=this._rect.height-4+"px";this._input.style.top="2px";e="2px 0"}else{e=
(this._rect.height-c(this.style("fontSize")))/2;e=E(e)+"px 0 "+G(e)+"px 0";this._input.style.margin=e}if(this._placeholderDom)this._placeholderDom.style.margin=e};this._updatePlaceholderVis=function(){if(this._placeholderDom)this._placeholderDom.style.display=this.value()?"none":"block"};this._focus=function(e){this._focusBackground=this._focusBackground||uki.theme.background(this._backgroundPrefix+"input-focus");this._focusBackground.attachTo(this);if(this._placeholderDom)this._placeholderDom.style.display=
"none";a._focus.call(this,e)};this._blur=function(e){this._focusBackground.detach();this._updatePlaceholderVis();a._blur.call(this,e)};this._bindToDom=function(e){return a._bindToDom.call(this,e)||b._bindToDom.call(this,e)}});uki.view.declare("uki.view.MultilineTextField",uki.view.TextField,function(b){this._setup=function(){b._setup.call(this);this._multiline=true}});(function(){function b(){a||uki.dom.probe(uki.createElement("div","position:absolute;left:-99em;width:100px;height:100px;overflow:scroll;",
'<div style="position:absolute;left:0;width:100%;"></div>'),function(d){a=d.offsetWidth-d.clientWidth;c=d.firstChild.offsetWidth==100});return a}var a,c;uki.view.declare("uki.view.ScrollPane",uki.view.Container,function(d){this.typeName=function(){return"uki.view.ScrollPane"};this._setup=function(){d._setup.call(this);uki.extend(this,{_clientRect:this.rect().clone(),_rectForChild:this.rect().clone(),_scrollableV:true,_scrollableH:false,_scrollV:false,_scrollH:false,_sbV:false,_sbH:false})};uki.addProps(this,
["scrollableV","scrollableH","scrollH","scrollV"]);this.rectForChild=function(){return this._rectForChild};this.clientRect=function(){return this._clientRect};this.scroll=function(f,e){f&&this.scrollTop(this.scrollLeft()+e);e&&this.scrollTop(this.scrollTop()+e)};uki.each(["scrollTop","scrollLeft"],function(f,e){this[e]=function(g){if(g==undefined)return this._dom[e];this._dom[e]=g;this.trigger("scroll",{source:this});return this}},this);this.visibleRect=function(){var f=this._clientRect.clone();f.x=
this.rect().x+this.scrollLeft();f.y=this.rect().y+this.scrollTop();return f};this.rect=function(f){if(f===undefined)return this._rect;f=q.create(f);var e=this._rect;this._parentRect=f;if(!this._resizeSelf(f))return this;this._updateClientRects();this._needsLayout=true;this.trigger("resize",{oldRect:e,newRect:this._rect,source:this});return this};this._createDom=function(){d._createDom.call(this);if(A.indexOf("Gecko/")>-1)this._dom.tabIndex="-1"};this._recalcClientRects=function(){b();var f=this.contentsWidth(),
e=this.contentsHeight();f=this._scrollableH?f>this._rect.width:false;e=this._scrollableV?e>this._rect.height:false;this._sbH=f||this._scrollH;this._sbV=e||this._scrollV;this._clientRect=new q(this._rect.width+(e?-1:0)*a,this._rect.height+(f?-1:0)*a);this._rectForChild=new q(this._rect.width+(e&&!c?-1:0)*a,this._rect.height+(f&&!c?-1:0)*a)};this._updateClientRects=function(){var f=this._clientRect;this._recalcClientRects();if(f.width!=this._clientRect.width||f.height!=this._clientRect.height)this._resizeChildViews(f)};
this._resizeChildViews=function(f){for(var e=0,g=this.childViews();e<g.length;e++)g[e].parentResized(f,this._clientRect)};this._layoutChildViews=function(){for(var f=0,e=this.childViews();f<e.length;f++)e[f]._needsLayout&&e[f].visible()&&e[f].layout()};this._layoutDom=function(f){this._updateClientRects();if(this._layoutScrollH!==this._sbH){this._dom.style.overflowX=this._sbH?"scroll":"hidden";this._layoutScrollH=this._sbH}if(this._layoutScrollV!==this._sbV){this._dom.style.overflowY=this._sbV?"scroll":
"hidden";this._layoutScrollV=this._sbV}d._layoutDom.call(this,f)}});uki.view.ScrollPane.initScrollWidth=b})();uki.view.list={};uki.view.declare("uki.view.List",uki.view.Base,uki.view.Focusable,function(b,a){function c(e,g){for(var j=new Array(g-e),k=0;e<=g;e++,k++)j[k]=e;return j}function d(e,g,j){for(var k=g=uki.binarySearch(g,e);e[g]<=j;)g++;g>k&&e.splice(k,g-k)}this._throttle=42;this._visibleRectExt=300;this._defaultBackground="theme(list)";this._setup=function(){b._setup.call(this);uki.extend(this,
{_rowHeight:30,_render:new uki.view.list.Render,_data:[],_lastClickIndex:-1,_selectedIndexes:[]})};this.defaultBackground=function(){return uki.theme.background("list",this._rowHeight)};uki.addProps(this,["render","packSize","visibleRectExt","throttle","contentDraggable","lastClickIndex","multiselect","lastClickIndex"]);this.rowHeight=uki.newProp("_rowHeight",function(e){this._rowHeight=e;this.minSize(new s(this.minSize().width,this._rowHeight*this._data.length));this._background&&this._background.detach();
this._background=null;this.background()&&this.background().attachTo(this);this._relayoutParent()});this.data=function(e){if(e===undefined)return this._data;this.clearSelection();this._data=e;this._packs[0].itemFrom=this._packs[0].itemTo=this._packs[1].itemFrom=this._packs[1].itemTo=0;this.minSize(new s(this.minSize().width,this._rowHeight*this._data.length));this.trigger("selection",{source:this});this._relayoutParent();return this};this.relayout=function(){this._packs[0].itemFrom=this._packs[0].itemTo=
this._packs[1].itemFrom=this._packs[1].itemTo=0;this.layout()};this.contentsSize=function(){return new s(this.rect().width,this._rowHeight*this._data.length)};this.addRow=function(e,g){this._data.splice(e,0,g);if(g=this._itemAt(e)){var j=p.createElement("div");j.innerHTML=this._rowTemplate.render({height:this._rowHeight,text:this._render.render(this._data[e],this._rowRect(e),e)});g.parentNode.insertBefore(j.firstChild,g);if(e<this._packs[0].itemTo){this._packs[0].itemTo++;this._packs[1].itemFrom++;
this._packs[1].itemTo++;this._packs[1].dom.style.top=this._packs[1].itemFrom*this._rowHeight+"px"}else this._packs[1].itemTo++}for(e=uki.binarySearch(e,this.selectedIndexes());e<this._selectedIndexes.length;e++)this._selectedIndexes[e]++;return this};this.removeRow=function(e){this._data.splice(e,1);this.data(this._data);return this};this.redrawRow=function(e){var g=this._itemAt(e);if(g)g.innerHTML=this._render.render(this._data[e],this._rowRect(e),e);return this};this.selectedIndex=function(e){if(e===
undefined)return this._selectedIndexes.length?this._selectedIndexes[0]:-1;this.selectedIndexes([e]);this._scrollToPosition(e);return this};this.selectedIndexes=function(e){if(e===undefined)return this._selectedIndexes;var g=e!=this._selectedIndexes;this.clearSelection(true);this._selectedIndexes=e;for(e=0;e<this._selectedIndexes.length;e++)this._setSelected(this._selectedIndexes[e],true);g&&this.trigger("selection",{source:this});return this};this.selectedRows=function(){return uki.map(this.selectedIndexes(),
function(e){return this._data[e]},this)};this.clearSelection=function(e){for(var g=0;g<this._selectedIndexes.length;g++)this._setSelected(this._selectedIndexes[g],false);this._selectedIndexes=[];if(!e)this._lastClickIndex=-1};this.isSelected=function(e){return this._selectedIndexes[uki.binarySearch(e,this._selectedIndexes)]==e};this.layout=function(){this._layoutDom(this._rect);this._needsLayout=false;this.trigger("layout",{rect:this._rect,source:this,visibleRect:this._visibleRect});this._firstLayout=
false};this._rowRect=function(e){return new q(0,e*this._rowHeight,this.rect().width,this._rowHeight)};this._toggleSelection=function(e){var g=[].concat(this._selectedIndexes),j=uki.binarySearch(e,g);g[j]==e?g.splice(j,1):g.splice(j,0,e);this.selectedIndexes(g)};var f=false;this._scrollableParentScroll=function(){if(!f)if(this._throttle){if(!this._throttleStarted){this._throttleStarted=true;setTimeout(uki.proxy(function(){this._throttleStarted=false;this.layout()},this),this._throttle)}}else this.layout()};
this._relayoutParent=function(){if(this._scrollableParent){for(var e=this;e&&e!=this._scrollableParent;){e._needsLayout=true;e=e.parent()}e.layout()}};this.keyPressEvent=function(){return u.opera||/mozilla/i.test(A)&&!/(compatible|webkit)/i.test(A)?"keypress":"keydown"};this._bindSelectionEvents=function(){this.bind("mousedown",this._mousedown);this.bind("mouseup",this._mouseup);this.bind(this.keyPressEvent(),this._keypress)};this._mouseup=function(e){if(this._multiselect){var g=uki.dom.offset(this._dom);
e=(e.pageY-g.y)/this._rowHeight<<0;this._selectionInProcess&&this._lastClickIndex==e&&this.isSelected(e)&&this.selectedIndexes([e]);this._selectionInProcess=false}};this._mousedown=function(e){var g=uki.dom.offset(this._dom);g=(e.pageY-g.y)/this._rowHeight<<0;var j=this._selectedIndexes;if(this._multiselect){this._selectionInProcess=false;if(e.shiftKey&&j.length>0)if(this.isSelected(g)){j=[].concat(j);d(j,Math.min(g+1,this._lastClickIndex),Math.max(g-1,this._lastClickIndex));this.selectedIndexes(j)}else this.selectedIndexes(c(Math.min(g,
j[0]),Math.max(g,j[j.length-1])));else if(e.metaKey)this._toggleSelection(g);else if(this.isSelected(g))this._selectionInProcess=true;else this.selectedIndexes([g])}else this.selectedIndexes([g]);this._lastClickIndex=g};this._keypress=function(e){var g=-1;if(e.which==38||e.keyCode==38){g=Math.max(0,this._lastClickIndex-1);e.preventDefault()}else if(e.which==40||e.keyCode==40){g=Math.min(this._data.length-1,this._lastClickIndex+1);e.preventDefault()}else if(this._multiselect&&(e.which==97||e.which==
65)&&e.metaKey){e.preventDefault();this.selectedIndexes(c(0,this._data.length-1))}if(g>-1&&g!=this._lastClickIndex){if(e.shiftKey&&this._multiselect){this.isSelected(g)?this._toggleSelection(this._lastClickIndex):this._toggleSelection(g);this._scrollToPosition(g)}else this.selectedIndex(g);this._lastClickIndex=g}};this._createDom=function(){this._dom=uki.createElement("div",this.defaultCss+"overflow:hidden");var e=uki.createElement("div","position:absolute;left:0;top:0px;width:100%;overflow:hidden");
this._packs=[{dom:e,itemTo:0,itemFrom:0},{dom:e.cloneNode(false),itemTo:0,itemFrom:0}];this._dom.appendChild(this._packs[0].dom);this._dom.appendChild(this._packs[1].dom);this._initFocusable();this._bindSelectionEvents()};this._setSelected=function(e,g){var j=this._itemAt(e);j&&this._render.setSelected(j,this._data[e],g,this.hasFocus())};this._scrollToPosition=function(e){if(this._visibleRect){var g;g=(e+1)*this._rowHeight;e=e*this._rowHeight;f=true;if(g>=this._visibleRect.maxY())this._scrollableParent.scroll(0,
g-this._visibleRect.maxY());else e<this._visibleRect.y&&this._scrollableParent.scroll(0,e-this._visibleRect.y);f=false;this.layout()}};this._itemAt=function(e){if(e<this._packs[1].itemTo&&e>=this._packs[1].itemFrom)return this._packs[1].dom.childNodes[e-this._packs[1].itemFrom];else if(e<this._packs[0].itemTo&&e>=this._packs[0].itemFrom)return this._packs[0].dom.childNodes[e-this._packs[0].itemFrom];return null};this._rowTemplate=new uki.theme.Template('<div style="width:100%;height:${height}px;overflow:hidden;">${text}</div>');
this._renderPack=function(e,g,j){var k=[];for(i=g;i<j;i++)k[k.length]=this._rowTemplate.render({height:this._rowHeight,text:this._render.render(this._data[i],this._rowRect(i),i)});e.dom.innerHTML=k.join("");e.itemFrom=g;e.itemTo=j;e.dom.style.top=g*this._rowHeight+"px";this._restorePackSelection(e,g,j)};this._restorePackSelection=function(e){var g=this._selectedIndexes;if(g[0]<=e.itemFrom&&g[g.length-1]>=e.itemFrom||g[0]<=e.itemTo&&g[g.length-1]>=e.itemTo||g[0]>=e.itemFrom&&g[g.length-1]<=e.itemTo){var j=
uki.binarySearch(e.itemFrom,g);for(j=Math.max(j,0);g[j]!==null&&g[j]<e.itemTo;){var k=g[j]-e.itemFrom;this._render.setSelected(e.dom.childNodes[k],this._data[k],true,this.hasFocus());j++}}};this._swapPacks=function(){var e=this._packs[0];this._packs[0]=this._packs[1];this._packs[1]=e};this._layoutDom=function(e){if(!this._scrollableParent){this._scrollableParent=uki.view.scrollableParent(this);this._scrollableParent.bind("scroll",uki.proxy(this._scrollableParentScroll,this))}var g=this._rowHeight*
this._data.length;this._visibleRect=uki.view.visibleRect(this,this._scrollableParent);if(this._focusTarget)this._focusTarget.style.top=this._visibleRect.y+"px";var j=E((this._visibleRect.height+this._visibleRectExt*2)/this._rowHeight),k=r(0,this._visibleRect.y-this._visibleRectExt),o=z(g,this._visibleRect.maxY()+this._visibleRectExt),l=this._packs[0].itemFrom*this._rowHeight,m=this._packs[1].itemTo*this._rowHeight;g=true;b._layoutDom.call(this,e);if(o<=l||k>=m||o>m&&this._packs[1].itemFrom*this._rowHeight>
this._visibleRect.y&&this._packs[1].itemTo>this._packs[1].itemFrom||k<l&&this._packs[0].itemTo*this._rowHeight<this._visibleRect.maxY()){e=k-this._visibleRectExt/2;e=r(0,Math.round(e/this._rowHeight));j=z(this._data.length,e+j);this._renderPack(this._packs[0],e,j);this._renderPack(this._packs[1],j,j)}else if(o>m&&this._packs[1].itemTo>this._packs[1].itemFrom){e=this._packs[1].itemTo;j=z(this._data.length,this._packs[1].itemTo+j);this._renderPack(this._packs[0],e,j);this._swapPacks()}else if(o>m){e=
this._packs[0].itemTo;j=z(this._data.length,this._packs[1].itemTo+j);this._renderPack(this._packs[1],e,j)}else if(k<l){e=r(this._packs[0].itemFrom-j,0);j=this._packs[0].itemFrom;this._renderPack(this._packs[1],e,j);this._swapPacks()}else g=false;if(g&&/MSIE 6|7/.test(A))this.dom().className+=""};this._bindToDom=function(e){return a._bindToDom.call(this,e)||b._bindToDom.call(this,e)};this._focus=function(e){a._focus.call(this,e);this._selectedIndexes.length==0&&this._data.length>0?this.selectedIndexes([0]):
this.selectedIndexes(this.selectedIndexes())};this._blur=function(e){a._blur.call(this,e);this.selectedIndexes(this.selectedIndexes())}});uki.Collection.addAttrs(["data","selectedIndex","selectedIndexes","selectedRows"]);uki.view.declare("uki.view.ScrollableList",uki.view.ScrollPane,function(b){this._createDom=function(){b._createDom.call(this);this._list=uki({view:"List",rect:this.rect().clone().normalize(),anchors:"left top right bottom"})[0];this.appendChild(this._list)};uki.each("data rowHeight render packSize visibleRectExt throttle focusable selectedIndexes selectedIndex selectedIndexes selectedRows multiselect contentDraggable draggable textSelectable".split(" "),
function(a,c){uki.delegateProp(this,c,"_list")},this)});uki.view.list.Render=uki.newClass({init:function(){},render:function(b,a){return'<div style="line-height: '+a.height+'px; font-size: 12px; padding: 0 4px;">'+b+"</div>"},setSelected:function(b,a,c,d){b.style.backgroundColor=c&&d?"#3875D7":c?"#CCC":"";b.style.color=c&&d?"#FFF":"#000"}});uki.view.table={};uki.view.declare("uki.view.Table",uki.view.Container,function(b){var a="rowHeight data packSize visibleRectExt render selectedIndex selectedIndexes selectedRows focus blur hasFocus lastClickIndex focusable textSelectable multiselect".split(" ");
this._headerHeight=this._rowHeight=17;this.defaultCss=b.defaultCss+"overflow:hidden;";this._listImpl="uki.view.List";uki.each(a,function(c,d){uki.delegateProp(this,d,"_list")},this);this._setup=function(){this._columns=[];b._setup.call(this)};this._style=function(c,d){this._header.style(c,d);return b._style.call(this,c,d)};this.list=function(){return this._list};this.header=function(){return this._header};this.columns=uki.newProp("_columns",function(c){for(var d=0;d<this._columns.length;d++)this._columns[d].unbind();
this._columns=uki.build(c);for(d=this._totalWidth=0;d<this._columns.length;d++){this._columns[d].position(d);this._columns[d].bind("beforeResize",uki.proxy(function(){this._updateTotalWidth();this._scrollPane.layout()},this))}this._updateTotalWidth();this._header.columns(this._columns)});this.redrawCell=function(c,d){var f=this._list._itemAt(c);if(f){var e=p.createElement("div");e.innerHTML=this.columns()[d].render(this.data()[c],new q(0,c*this.rowHeight(),this.list().width(),this.rowHeight()),c);
f.replaceChild(e.firstChild,f.childNodes[d])}return this};uki.each(["redrawRow","addRow","removeRow"],function(c,d){this[d]=function(){this.list()[d].apply(this.list(),arguments);return this}},this);this.redrawColumn=function(c){for(var d=this._list._packs[1].itemTo,f=this._list._packs[0].itemFrom;f<d;f++)this.redrawCell(f,c);return this};this._updateTotalWidth=function(){for(var c=this._totalWidth=0;c<this._columns.length;c++){this._columns[c].position(c);this._totalWidth+=this._columns[c].width()}this._list.minSize(new s(this._totalWidth,
this._list.minSize().height));this._header.minSize(new s(this._totalWidth,0))};this._createDom=function(){b._createDom.call(this);var c=new q(0,this._headerHeight,this.rect().width,this.rect().height-this._headerHeight),d=c.clone().normalize(),f=new q(0,0,this.rect().width,this._headerHeight),e={view:this._listImpl,rect:d,anchors:"left top bottom right",render:new uki.view.table.Render(this),className:"table-list"};c={view:"ScrollPane",rect:c,anchors:"left top right bottom",scrollableH:true,childViews:[e],
className:"table-scroll-pane"};f={view:"table.Header",rect:f,anchors:"top left right",className:"table-header"};uki.each(a,function(g,j){if(this["_"+j]!==undefined)e[j]=this["_"+j]},this);this._scrollPane=uki.build(c)[0];this._list=this._scrollPane.childViews()[0];this._header=uki.build(f)[0];this._scrollPane.resizeToContents();this.appendChild(this._header);this.appendChild(this._scrollPane);this._scrollPane.bind("scroll",uki.proxy(function(){this._header.dom().style.left=-this._scrollPane.scrollLeft()+
"px"},this))}});uki.Collection.addAttrs(["columns"]);uki.view.table.Render=uki.newClass(uki.view.list.Render,new (function(){this.init=function(b){this._table=b};this.render=function(b,a,c){var d=this._table.columns();return uki.map(d,function(f,e){return d[e].render(b,a,c)}).join("")}}));uki.view.table.Column=uki.newClass(uki.view.Observable,new (function(){this._width=100;this._maxWidth=this._minWidth=this._position=this._offset=0;this._css="float:left;white-space:nowrap;text-overflow:ellipsis;";
this._inset=new x(3,5);this.init=function(){};uki.addProps(this,["position","css","formatter","label","resizable","maxWidth","minWidth","maxWidth","key"]);this.template=function(b){if(b===undefined)return this._template=this._template||uki.theme.template("table-cell");this._template=b;return this};this.headerTemplate=function(b){if(b===undefined)return this._headerTemplate=this._headerTemplate||uki.theme.template("table-header-cell");this._headerTemplate=b;return this};this.width=uki.newProp("_width",
function(b){var a={oldWidth:this._width,source:this};this._width=this._normailizeWidth(b);a.newWidth=this._width;this.trigger("beforeResize",a);if(this._stylesheet&&a.newWidth!=a.oldWidth)(this._stylesheet.styleSheet?this._stylesheet.styleSheet.rules:this._stylesheet.sheet.cssRules)[0].style.width=this._clientWidth()+"px";this.trigger("resize",a)});this._bindToDom=uki.F;this._normailizeWidth=function(b){if(this._maxWidth)b=z(this._maxWidth,b);if(this._minWidth)b=r(this._minWidth,b);return b};this.inset=
uki.newProp("_inset",function(b){this._inset=x.create(b)});this.render=function(b,a){this._prerenderedTemplate||this._prerenderTemplate(a);a=this._key?uki.attr(b,this._key):b[this._position];this._prerenderedTemplate[1]=this._formatter?this._formatter(a,b):a;return this._prerenderedTemplate.join("")};this.appendResizer=function(b,a){a=uki.theme.dom("resizer",a);b.appendChild(a);return a};this.renderHeader=function(b){this._className||this._initStylesheet();return this.headerTemplate().render({data:'<div style="overflow:hidden;text-overflow:ellipsis;*width:100%;height:100%;">'+
this.label()+"</div>",style:"*overflow-y:hidden;"+this._cellStyle(uki.dom.offset.boxModel?b-1:b),className:this._className})};this._prerenderTemplate=function(b){this._className||this._initStylesheet();this._prerenderedTemplate=this.template().render({data:"\u0001\u0001",style:"overflow:hidden;"+this._cellStyle(b.height),className:this._className}).split("\u0001")};this._cellPadding=function(){var b=this._inset;return["padding:",b.top,"px ",b.right,"px ",b.bottom,"px ",b.left,"px;"].join("")};this._cellStyle=
function(b){b="height:"+(b-(uki.dom.offset.boxModel?this._inset.height():0))+"px;";return this._css+this._cellPadding()+";"+b};this._clientWidth=function(){return this._width-(uki.dom.offset.boxModel?this._inset.width()+1:0)};this._initStylesheet=function(){if(!this._className){uki.dom.offset.initializeBoxModel();this._className="uki-table-column-"+uki.guid++;var b="."+this._className+" {width:"+this._clientWidth()+"px;}";this._stylesheet=uki.dom.createStylesheet(b)}}}));uki.view.table.NumberColumn=
uki.newClass(uki.view.table.Column,new function(){this._css=uki.view.table.Column.prototype._css+"text-align:right;"});uki.view.table.CustomColumn=uki.view.table.Column;uki.view.table.Header=uki.newClass(uki.view.Label,function(b){this._setup=function(){b._setup.call(this);this._multiline=true;this._resizers=[]};this.typeName=function(){return"uki.view.table.Header"};this.columns=uki.newProp("_columns",function(a){this._columns=a;this.html(this._createColumns());this._createResizers()});this.redrawColumn=
function(a){this._resizers[a]&&uki.dom.unbind(this._resizers[a]);var c=p.createElement("div");c.innerHTML=this._columns[a].renderHeader(this.rect().height);this._label.replaceChild(c.firstChild,this._label.childNodes[a]);this._columns[a].resizable()&&this._createResizers(a)};this._createColumns=function(){for(var a=[],c=0,d=this._columns,f=d.length;c<f;c++)a[a.length]=d[c].renderHeader(this.rect().height);return a.join("")};this._createResizer=function(a){var c=this._columns[a];if(c.resizable()){c=
c.appendResizer(this._label.childNodes[a],this.rect().height);this._bindResizerDrag(c,a);this._resizers[a]=c}};this._createResizers=function(){uki.each(this._columns,this._createResizer,this)};this._bindResizerDrag=function(a,c){uki.dom.bind(a,"draggesture",uki.proxy(function(d){var f=uki.dom.offset(this.dom());d=d.pageX-f.x;f=0;var e,g=this._columns[c];for(e=0;e<c;e++)f+=this._columns[e].width();g.width(d-f)},this))}});uki.view.declare("uki.view.Slider",uki.view.Base,uki.view.Focusable,function(b,
a){this._setup=function(){b._setup.call(this);uki.extend(this,{_min:0,_max:1,_value:0,_values:null,_keyStep:0.01})};uki.addProps(this,["min","max","values","keyStep"]);this.values=uki.newProp("_values",function(c){this._values=c;this._min=c[0];this._max=c[c.length-1]});this.value=uki.newProp("_value",function(c){this._value=r(this._min,z(this._max,c));this._position=this._val2pos(this._value);this._moveHandle();this.trigger("change",{source:this,value:this._value})});this._pos2val=function(c,d){if(this._values){c=
Math.round(1*c/this._rect.width*(this._values.length-1));if(d)this._cachedIndex=c;return this._values[c]}return c/this._rect.width*(this._max-this._min)};this._val2pos=function(c){if(this._values)return(this._cachedIndex!==undefined?this._cachedIndex:uki.binarySearch(c,this._values))/(this._values.length-1)*this._rect.width;return c/(this._max-this._min)*this._rect.width};this._createDom=function(){this._dom=uki.createElement("div",b.defaultCss+"height:18px;-moz-user-select:none;-webkit-user-select:none;overflow:visible;");
this._handle=uki.createElement("div",b.defaultCss+"overflow:hidden;cursor:default;background:url("+uki.theme.image("x").src+")");this._bg=uki.theme.image("slider-handle");this._focusBg=uki.theme.image("slider-focus");this._focusBg.style.cssText+=this._bg.style.cssText+=b.defaultCss+"top:0;left:0;z-index:-1;position:absolute;";this._handle.appendChild(this._bg);uki.theme.background("slider-bar").attachTo(this);this._initFocusable();uki.image.load([this._bg,this._focusBg],uki.proxy(this._afterHandleLoad,
this))};this._afterHandleLoad=function(){this._focusBg.style.cssText+=";z-index:10;margin-left:-"+this._focusBg.width/2+"px;margin-top:-"+(this._focusBg.height-this._bg.height/2+1)/2+"px;";this._handle.style.cssText+=";margin-left:-"+this._bg.width/2+"px;width:"+this._bg.width+"px;height:"+this._bg.height/2+"px;";this._dom.appendChild(this._handle);uki.each(["mouseenter","mouseleave","draggesturestart","draggesture","draggestureend"],function(c,d){uki.dom.bind(this._handle,d,uki.proxy(this["_"+d],
this))},this);this.bind("click",this._click);this.bind(uki.view.List.prototype.keyPressEvent(),this._keypress)};this._mouseenter=function(){this._over=true;this._bg.style.top=-this._bg.height/2+"px"};this._mouseleave=function(){this._over=false;this._bg.style.top=this._dragging?-this._bg.height/2+"px":0};this._click=function(c){this.value(this._pos2val(c.pageX-uki.dom.offset(this._dom).x,true));this._cachedIndex=undefined};this._keypress=function(c){if(c.which==39||c.keyCode==39)this.value(this.value()+
this._keyStep*(this._max-this._min));else if(c.which==37||c.keyCode==37)this.value(this.value()-this._keyStep*(this._max-this._min))};this._moveHandle=function(){this._focusBg.style.left=this._handle.style.left=this._position+"px"};this._draggesturestart=function(){this._dragging=true;this._initialPosition=new v(parseInt(this._handle.style.left,10),parseInt(this._handle.style.top,10));return true};this._draggesture=function(c){this.value(this._pos2val(r(0,z(this._rect.width,this._initialPosition.x+
c.dragOffset.x)),true));this._cachedIndex=undefined};this._draggestureend=function(){this._dragging=false;this._initialPosition=null;if(!this._over)this._bg.style.top=0;this.value(this._pos2val(this._position,true));this._cachedIndex=undefined};this._focus=function(c){this._dom.appendChild(this._focusBg);this._focusBg.style.left=this._handle.style.left;a._focus.call(this,c)};this._blur=function(c){this._dom.removeChild(this._focusBg);a._blur.call(this,c)};this._layoutDom=function(c){c=c.clone();c.height=
18;b._layoutDom.call(this,c);this._position=this._val2pos(this._value);this._moveHandle();return true};this._bindToDom=function(c){if(c=="change")return true;return uki.view.Focusable._bindToDom.call(this,c)||b._bindToDom.call(this,c)}});uki.view.declare("uki.view.HSplitPane",uki.view.Container,function(b){this._setup=function(){b._setup.call(this);this._originalRect=this._rect;uki.extend(this,{_vertical:false,_handlePosition:200,_autogrowLeft:false,_autogrowRight:true,_handleWidth:7,_leftMin:100,
_rightMin:100,_panes:[]})};this.handlePosition=uki.newProp("_handlePosition",function(a){this._handlePosition=this._normalizePosition(a);this.trigger("handleMove",{source:this,handlePosition:this._handlePosition,dragValue:a});this._resizeChildViews()});this.handleWidth=uki.newProp("_handleWidth",function(a){if(this._handleWidth!=a){this._handleWidth=a;a=this._createHandle();this._dom.insertBefore(a,this._handle);this._removeHandle();this._handle=a;this._resizeChildViews()}});this._normalizePosition=
function(a){var c=this._vertical?"height":"width";return r(this._leftMin,z(this._rect[c]-this._rightMin-this._handleWidth,r(0,z(this._rect?this._rect[c]:1E3,a*1))))};uki.addProps(this,["leftMin","rightMin","autogrowLeft","autogrowRight"]);this.topMin=this.leftMin;this.bottomMin=this.rightMin;this._removeHandle=function(){this._dom.removeChild(this._handle)};this._createHandle=function(){var a;if(this._vertical){a=uki.theme.dom("splitPane-vertical",{handleWidth:this._handleWidth});a.style.top=this._handlePosition+
"px"}else{a=uki.theme.dom("splitPane-horizontal",{handleWidth:this._handleWidth});a.style.left=this._handlePosition+"px"}uki.each(["draggesturestart","draggesture","draggestureend"],function(c,d){uki.dom.bind(a,d,uki.proxy(this["_"+d],this))},this);return a};this._createDom=function(){this._dom=uki.createElement("div",b.defaultCss);for(var a=0,c;a<2;a++){c={view:"Container"};c.anchors=a==1?"left top bottom right":this._vertical?"left top right":"left top bottom";c.rect=a==0?this._leftRect():this._rightRect();
this._panes[a]=uki.build(c)[0];this.appendChild(this._panes[a])}this._dom.appendChild(this._handle=this._createHandle())};this._normalizeRect=function(a){a=b._normalizeRect.call(this,a);a=a.clone();if(this._vertical)a.height=r(a.height,this._leftMin+this._rightMin);else a.width=r(a.width,this._leftMin+this._rightMin);return a};this._resizeSelf=function(a){var c=this._rect,d=this._vertical?"height":"width";if(!b._resizeSelf.call(this,a))return false;if(this._autogrowLeft){c=a[d]-c[d];this._handlePosition=
this._normalizePosition(this._handlePosition+(this._autogrowRight?c/2:c))}if(this._vertical){if(a.height-this._handlePosition<this._rightMin)this._handlePosition=r(this._leftMin,a.height-this._rightMin)}else if(a.width-this._handlePosition<this._rightMin)this._handlePosition=r(this._leftMin,a.width-this._rightMin);return true};this._draggesturestart=function(a){var c=uki.dom.offset(this.dom());this._posWithinHandle=a[this._vertical?"pageY":"pageX"]-c[this._vertical?"y":"x"]-this._handlePosition;return true};
this._draggesture=function(a){var c=uki.dom.offset(this.dom());this.handlePosition(a[this._vertical?"pageY":"pageX"]-c[this._vertical?"y":"x"]-this._posWithinHandle);this.layout()};this._draggestureend=function(){};this.topPane=this.leftPane=function(a){return this._paneAt(0,a)};this.bottomPane=this.rightPane=function(a){return this._paneAt(1,a)};this.topChildViews=this.leftChildViews=function(a){return this._childViewsAt(0,a)};this.bottomChildViews=this.rightChildViews=function(a){return this._childViewsAt(1,
a)};this._childViewsAt=function(a,c){if(c===undefined)return this._panes[a].childViews();this._panes[a].childViews(c);return this};this._paneAt=function(a,c){if(c===undefined)return this._panes[a];uki.build.copyAttrs(this._panes[a],c);return this};this._leftRect=function(){return this._vertical?new q(this._rect.width,this._handlePosition):new q(this._handlePosition,this._rect.height)};this._rightRect=function(){return this._vertical?new q(0,this._handlePosition+this._handleWidth,this._rect.width,
this._rect.height-this._handleWidth-this._handlePosition):new q(this._handlePosition+this._handleWidth,0,this._rect.width-this._handleWidth-this._handlePosition,this._rect.height)};this._resizeChildViews=function(){this._panes[0].rect(this._leftRect());this._panes[1].rect(this._rightRect())};this._layoutDom=function(a){b._layoutDom.call(this,a);this._handle.style[this._vertical?"top":"left"]=this._handlePosition+"px"};this._bindToDom=function(a){if(a=="handleMove")return true;return b._bindToDom.call(this,
a)}});uki.view.declare("uki.view.VSplitPane",uki.view.HSplitPane,function(b){this._setup=function(){b._setup.call(this);this._vertical=true}});uki.Collection.addAttrs(["handlePosition"]);uki.view.declare("uki.view.Popup",uki.view.Container,function(b){this._setup=function(){b._setup.call(this);uki.extend(this,{_offset:2,_relativeTo:null,_horizontal:false,_flipOnResize:true,_defaultBackground:"theme(popup-normal)"})};this._createDom=function(){b._createDom.call(this);this.hideOnClick(true)};uki.addProps(this,
["offset","relativeTo","horizontal","flipOnResize"]);this.hideOnClick=function(a){if(a===undefined)return this._clickHandler;if(a!=!!this._clickHandler)if(a){this._clickHandler=this._clickHandler||uki.proxy(function(c){uki.dom.contains(this._relativeTo.dom(),c.target)||uki.dom.contains(this.dom(),c.target)||this.hide()},this);uki.dom.bind(p.body,"mousedown",this._clickHandler);uki.dom.bind(u,"resize",this._clickHandler)}else{uki.dom.unbind(p.body,"mousedown",this._clickHandler);uki.dom.unbind(u,"resize",
this._clickHandler);this._clickHandler=false}return this};this.toggle=function(){this.parent()&&this.visible()?this.hide():this.show()};this.show=function(){this.visible(true);if(this.parent()){this.rect(this._recalculateRect());this.layout(this._rect)}else new uki.Attachment(u,this);this.trigger("toggle",{source:this})};this.hide=function(){this.visible(false);this.trigger("toggle",{source:this})};this.parentResized=function(){this.rect(this._recalculateRect())};this._resizeSelf=function(a){this._rect=
this._normalizeRect(a);return true};this._layoutDom=function(a){return b._layoutDom.call(this,a)};this._recalculateRect=function(){if(!this.visible())return this._rect;var a=uki.dom.offset(this._relativeTo.dom()),c=this._relativeTo.rect(),d=this.rect().clone(),f=uki.view.top(this);f.rect();f=uki.dom.offset(f.dom());var e=new v,g=this._horizontal?this._offset:0,j=this._horizontal?0:this._offset;a.offset(-f.x,-f.y);e.x=this._anchors&2?a.x+c.width-(this._horizontal?0:d.width)+g:a.x-(this._horizontal?
d.width:0)-g;e.y=this._anchors&4?a.y+(this._horizontal?c.height:0)-d.height-j:a.y+(this._horizontal?0:c.height)+j;return new q(e.x,e.y,d.width,d.height)}});uki.each(["show","hide","toggle"],function(b,a){uki.fn[a]=function(){this.each(function(){this[a]()})}});uki.view.declare("uki.view.VFlow",uki.view.Container,function(b){this.contentsSize=function(){var a=uki.reduce(0,this._childViews,function(c,d){return c+(d.visible()?d.rect().height:0)});return new s(this.contentsWidth(),a)};this.hidePartlyVisible=
uki.newProp("_hidePartlyVisible");this.resizeToContents=function(a){this._resizeChildViews(this._rect);return b.resizeToContents.call(this,a)};uki.each(["appendChild","removeChild","insertBefore"],function(a,c){this[c]=function(d,f){this._contentChanged=true;return b[c].call(this,d,f)}},this);this.layout=function(){this._contentChanged&&this._resizeChildViews(this._rect);return b.layout.call(this)};this._resizeChildViews=function(a){this._contentChanged=false;for(var c=0,d,f=0,e=this.childViews();f<
e.length;f++){d=e[f];d.parentResized(a,this._rect);d.rect().y=c;this._hidePartlyVisible&&d.visible(d._rect.height+c<=this._rect.height);if(d.visible())c+=d._rect.height}}});uki.view.declare("uki.view.HFlow",uki.view.VFlow,function(){this.contentsSize=function(){var b=uki.reduce(0,this._childViews,function(a,c){return a+(c.visible()?c.rect().width:0)});return new s(b,this.contentsHeight())};this._resizeChildViews=function(b){for(var a=0,c,d=0,f=this.childViews();d<f.length;d++){c=f[d];c.parentResized(b,
this._rect);c.rect().x=a;this._hidePartlyVisible&&c.visible(c._rect.width+a<=this._rect.width);if(c.visible())a+=c._rect.width}}});uki.view.toolbar={};uki.view.declare("uki.view.Toolbar",uki.view.Container,function(b){this.typeName=function(){return"uki.view.Toolbar"};this._moreWidth=30;this._setup=function(){b._setup.call(this);this._buttons=[];this._widths=[]};this.buttons=uki.newProp("_buttons",function(a){this._buttons=a;this._flow.childViews(uki.build(uki.map(this._buttons,this._createButton,
this)).resizeToContents("width"));this._totalWidth=uki.reduce(0,this._flow.childViews(),function(c,d){return c+d.rect().width})});uki.moreWidth=uki.newProp("_moreWidth",function(a){this._moreWidth=a;this._updateMoreVisible()});this._createDom=function(){b._createDom.call(this);var a=this.rect(),c=a.clone().normalize();a={view:"Button",rect:new q(a.width-this._moreWidth,0,this._moreWidth,a.height),anchors:"right top",className:"toolbar-button",visible:false,backgroundPrefix:"toolbar-more-",text:">>",
focusable:false};var d={view:"Popup",rect:"0 0",anchors:"right top",className:"toolbar-popup",background:"theme(toolbar-popup)",childViews:{view:"VFlow",rect:"0 5 0 0",anchors:"right top left bottom"}};this._flow=uki.build({view:"HFlow",rect:c,anchors:"left top right",className:"toolbar-flow",hidePartlyVisible:true})[0];this._more=uki.build(a)[0];this.appendChild(this._flow);this.appendChild(this._more);d.relativeTo=this._more;this._popup=uki.build(d)[0];this._more.bind("click",uki.proxy(this._showMissingButtons,
this))};this._showMissingButtons=function(){for(var a=this._flow.rect().width,c=0,d=[],f=0,e=this._flow.childViews(),g=e.length;f<g;f++){c+=e[f].rect().width;c>a&&d.push(f)}a=uki.map(d,function(j){var k={html:e[j].html(),backgroundPrefix:"toolbar-popup-button-"};uki.each(["fontSize","fontWeight","color","textAlign","inset"],function(o,l){k[l]=uki.attr(e[j],l)});return this._createButton(k)},this);uki("VFlow",this._popup).childViews(a).resizeToContents("width height");this._popup.resizeToContents("width height").height(this._popup.height()+
5).toggle()};this._updateMoreVisible=function(){var a=this._rect;if(this._more.visible()!=a.width<this._totalWidth){this._more.visible(a.width<this._totalWidth);var c=this._flow.rect();c.width+=(a.width<this._totalWidth?-1:1)*this._moreWidth;this._flow.rect(c)}};this.rect=function(a){var c=b.rect.call(this,a);a&&this._updateMoreVisible();return c};this._createButton=function(a){var c=this.rect().clone().normalize();c.width=100;return uki.extend({view:"Button",rect:c,focusable:false,align:"left",anchors:"left top",
backgroundPrefix:"toolbar-button-",autosizeToContents:"width",focusable:false},a)}})})();
